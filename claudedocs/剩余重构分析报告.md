# å‰©ä½™é‡æ„åˆ†ææŠ¥å‘Š

**é¡¹ç›®**: chat_edit
**åˆ†ææ—¥æœŸ**: 2025-10-01
**å½“å‰çŠ¶æ€**: ç¬¬äºŒé˜¶æ®µé‡æ„å®Œæˆå

---

## ğŸ“Š æ‰§è¡Œæ‘˜è¦

### å½“å‰å¥åº·åº¦æŒ‡æ ‡

| æŒ‡æ ‡ | ç°çŠ¶ | ç›®æ ‡ | çŠ¶æ€ |
|-----|------|------|------|
| **é¡¹ç›®å¥åº·åº¦** | 88/100 | 90+ | ğŸŸ¡ æ¥è¿‘ç›®æ ‡ |
| **ESLint è­¦å‘Š** | 86 | <50 | ğŸŸ¡ éœ€è¦æ”¹è¿› |
| **ESLint é”™è¯¯** | 5 | 0 | ğŸŸ¡ éœ€ä¿®å¤ |
| **æœ€å¤§æ–‡ä»¶è¡Œæ•°** | 488 | <300 | ğŸŸ¡ å¯ä¼˜åŒ– |
| **æµ‹è¯•è¦†ç›–ç‡** | 0% | 60%+ | ğŸ”´ æ€¥éœ€å»ºç«‹ |
| **æ‰“åŒ…ä½“ç§¯è­¦å‘Š** | 3ä¸ª >1.5MB | ä¼˜åŒ– | ğŸŸ¡ éœ€ä¼˜åŒ– |
| **TypeScript any** | 11å¤„ | <5 | ğŸŸ¡ å¯æ”¹è¿› |
| **TODO æ³¨é‡Š** | 4å¤„ | 0 | ğŸŸ¢ è‰¯å¥½ |

### é‡æ„è¿›å±•æ€»ç»“

âœ… **å·²å®Œæˆï¼ˆ8å¤§ä»»åŠ¡ï¼‰**:
- ç»Ÿä¸€é”™è¯¯å¤„ç†ç³»ç»Ÿï¼ˆ51å¤„æ ‡å‡†åŒ–ï¼‰
- å†…å­˜æ³„æ¼ä¿®å¤ï¼ˆ15+ æ¸…ç†ï¼‰
- AIEditing ä¸»å®¹å™¨é‡æ„ï¼ˆ1164 â†’ 488 è¡Œï¼Œ-58%ï¼‰
- util.ts æ¨¡å—åŒ–æ‹†åˆ†ï¼ˆ1122 â†’ 8ä¸ªæ¨¡å—ï¼‰
- Composables æå–ï¼ˆ6ä¸ªæ ¸å¿ƒæ¨¡å—ï¼‰
- UI ç»„ä»¶åˆ†ç¦»ï¼ˆ5ä¸ªç‹¬ç«‹ç»„ä»¶ï¼‰

ğŸŸ¡ **è¿›è¡Œä¸­**:
- ESLint è­¦å‘Šæ¸…ç†ï¼ˆ100+ â†’ 86ï¼‰
- ä»£ç è´¨é‡ä¼˜åŒ–

ğŸ”´ **å¾…å®Œæˆ**:
- æµ‹è¯•åŸºç¡€è®¾æ–½å»ºè®¾ï¼ˆ0%è¦†ç›–ï¼‰
- æ€§èƒ½ä¼˜åŒ–ï¼ˆæ‰“åŒ…ä½“ç§¯ï¼‰
- TypeScript ç±»å‹å®Œå–„

---

## ğŸ¯ ä¼˜å…ˆçº§é—®é¢˜æ¸…å•

### ğŸ”´ é«˜ä¼˜å…ˆçº§ï¼ˆç«‹å³å¤„ç†ï¼‰

#### 1. ESLint è¯­æ³•é”™è¯¯ï¼ˆ5å¤„ - é˜»å¡æ„å»ºï¼‰

**é—®é¢˜**: 5ä¸ª parsing error é”™è¯¯ä¼šå¯¼è‡´ç±»å‹æ£€æŸ¥å’Œ IDE æ”¯æŒå¤±æ•ˆ

**ä½ç½®**:
```typescript
// src/components/AIEditing/index.vue:81, 84, 338, 511
// Parsing error: '>' expected æˆ– Expression expected

// src/components/AIEditing/components/AIResponsePanel.vue:91
// The template requires child element (vue/valid-template-root)
```

**å½±å“**: ğŸ”´ ä¸¥é‡
- é˜»æ­¢ TypeScript ç±»å‹æ£€æŸ¥æ­£å¸¸å·¥ä½œ
- IDE è‡ªåŠ¨è¡¥å…¨å¤±æ•ˆ
- æ½œåœ¨è¿è¡Œæ—¶é”™è¯¯

**ä¿®å¤æ–¹æ¡ˆ**:

```typescript
// ã€ä¿®å¤å‰ã€‘ index.vue ç¬¬ 81-84 è¡Œ
<template v-slot:header>
  <!-- ç¼ºå°‘æ­£ç¡®çš„æ’æ§½è¯­æ³• -->
</template>

// ã€ä¿®å¤åã€‘
<template #header>
  <!-- ä½¿ç”¨ç®€å†™æ’æ§½è¯­æ³• -->
</template>

// ã€ä¿®å¤å‰ã€‘ AIResponsePanel.vue
<template>
  <div v-if="false">
    <!-- ç©ºæ ¹å…ƒç´  -->
  </div>
</template>

// ã€ä¿®å¤åã€‘
<template>
  <div>
    <!-- ä¿è¯è‡³å°‘æœ‰ä¸€ä¸ªæœ‰æ•ˆæ ¹å…ƒç´  -->
    <slot />
  </div>
</template>
```

**é¢„ä¼°å·¥ä½œé‡**: 1-2 å°æ—¶

---

#### 2. æœªä½¿ç”¨å˜é‡æ¸…ç†ï¼ˆ19å¤„è­¦å‘Šï¼‰

**é—®é¢˜**: index.vue ä¸­å­˜åœ¨å¤§é‡æœªä½¿ç”¨çš„è§£æ„å˜é‡

**ä½ç½®**: `src/components/AIEditing/index.vue:59-79`

```typescript
// ã€é—®é¢˜ä»£ç ã€‘
const {
  quill,           // âŒ unused
  toolbar,         // âŒ unused
  diffEditor,      // âŒ unused
  currentRange,    // âŒ unused
  // ... å…±19ä¸ªæœªä½¿ç”¨å˜é‡
} = composableReturns

// ã€ä¿®å¤æ–¹æ¡ˆ1 - ä½¿ç”¨ä¸‹åˆ’çº¿å‰ç¼€ã€‘
const {
  _quill,          // âœ… æ˜ç¡®æ ‡è®°ä¸ºæœªä½¿ç”¨
  _toolbar,
  // ...
} = composableReturns

// ã€ä¿®å¤æ–¹æ¡ˆ2 - åˆ é™¤æœªä½¿ç”¨å˜é‡ï¼ˆæ¨èï¼‰ã€‘
// åªä¿ç•™çœŸæ­£éœ€è¦çš„å˜é‡
const {
  isGenerating,
  handleSend,
  handleRegenerate,
} = composableReturns
```

**å½±å“**: ğŸŸ¡ ä¸­ç­‰
- ä»£ç æ··æ·†ï¼Œéš¾ä»¥ç†è§£å®é™…ä¾èµ–
- ESLint è­¦å‘Šç´¯ç§¯
- æ½œåœ¨çš„æ­»ä»£ç 

**æ·±å±‚åŸå› **: Composable è¿”å›äº†è¿‡å¤šä¸å¿…è¦çš„å†…éƒ¨çŠ¶æ€

**æ ¹æœ¬è§£å†³æ–¹æ¡ˆ**:

```typescript
// ã€é‡æ„ Composablesã€‘
// æ–‡ä»¶: src/components/AIEditing/composables/useAIEditorActions.ts

// ã€ä¿®å¤å‰ã€‘è¿”å›æ‰€æœ‰å†…éƒ¨çŠ¶æ€
export function useAIEditorActions(...) {
  return {
    // æš´éœ²å†…éƒ¨å®ç°ç»†èŠ‚
    quill,
    toolbar,
    diffEditor,
    currentRange,
    // ...

    // æš´éœ²å…¬å…±API
    handleSend,
    handleRegenerate,
  }
}

// ã€ä¿®å¤åã€‘åªè¿”å›å…¬å…±API
export function useAIEditorActions(...) {
  // å†…éƒ¨çŠ¶æ€
  const quill = ref(null)
  const toolbar = ref(null)

  // åªæš´éœ²è¡Œä¸ºï¼Œä¸æš´éœ²çŠ¶æ€
  return {
    // å…¬å…±API
    handleSend,
    handleRegenerate,
    handleDiffInsertAfter,
  }
}
```

**é¢„ä¼°å·¥ä½œé‡**: 2-3 å°æ—¶

---

#### 3. TypeScript `any` ç±»å‹æ¶ˆé™¤ï¼ˆ11å¤„ï¼‰

**é—®é¢˜**: å¤šå¤„ä½¿ç”¨ `any` å¯¼è‡´ç±»å‹å®‰å…¨ç¼ºå¤±

**ä½ç½®åˆ†å¸ƒ**:
- `export.ts`: 7å¤„ï¼ˆquill å®ä¾‹ã€DOM èŠ‚ç‚¹ï¼‰
- `api.ts`: 3å¤„ï¼ˆå›è°ƒå‡½æ•°ã€æ¨¡å‹æ•°æ®ï¼‰
- `chat.ts`: 1å¤„ï¼ˆmeta å­—æ®µï¼‰

**å½±å“**: ğŸŸ¡ ä¸­ç­‰
- å¤±å»ç±»å‹æ£€æŸ¥ä¿æŠ¤
- æ½œåœ¨è¿è¡Œæ—¶é”™è¯¯
- é‡æ„å›°éš¾

**ä¿®å¤æ–¹æ¡ˆ**:

```typescript
// ã€é—®é¢˜1ã€‘ export.ts:19-21 - Quill å®ä¾‹ç±»å‹
// ã€ä¿®å¤å‰ã€‘
private quill?: any
constructor(content: string, quill?: any) {
  this.quill = quill
}

// ã€ä¿®å¤åã€‘
import type Quill from 'quill'

private quill?: Quill
constructor(content: string, quill?: Quill) {
  this.quill = quill
}

// =====================================

// ã€é—®é¢˜2ã€‘ api.ts:73 - å›è°ƒå‡½æ•°ç±»å‹
// ã€ä¿®å¤å‰ã€‘
generateChat: async (
  request: ChatRequest,
  onDataReceived: (data: any) => void,  // âŒ any
): Promise<ChatResponse[]>

// ã€ä¿®å¤åã€‘
type StreamCallback = (data: ChatPartResponse | ChatCompletedResponse) => void

generateChat: async (
  request: ChatRequest,
  onDataReceived: StreamCallback,  // âœ… ç±»å‹å®‰å…¨
): Promise<ChatResponse[]>

// =====================================

// ã€é—®é¢˜3ã€‘ chat.ts:246 - meta å­—æ®µç±»å‹
// ã€ä¿®å¤å‰ã€‘
async function addSystemMessage(content: string | null, meta?: any)

// ã€ä¿®å¤åã€‘
interface SystemMessageMeta {
  timestamp?: number
  source?: string
  [key: string]: unknown  // å…è®¸æ‰©å±•
}

async function addSystemMessage(
  content: string | null,
  meta?: SystemMessageMeta
)
```

**é¢„ä¼°å·¥ä½œé‡**: 3-4 å°æ—¶

---

### ğŸŸ¡ ä¸­ä¼˜å…ˆçº§ï¼ˆè¿‘æœŸå¤„ç†ï¼‰

#### 4. æ–‡ä»¶æ‹†åˆ†ä¼˜åŒ–ï¼ˆ3ä¸ªè¶…å¤§æ–‡ä»¶ï¼‰

**é—®é¢˜**: ä»æœ‰3ä¸ªæ–‡ä»¶è¶…è¿‡å»ºè®®çš„300è¡Œ

| æ–‡ä»¶ | è¡Œæ•° | å»ºè®®è¡Œæ•° | å¤æ‚åº¦ | ä¼˜å…ˆçº§ |
|-----|------|----------|-------|--------|
| `stores/chat.ts` | 486 | 300-400 | ğŸŸ¡ ä¸­ | P1 |
| `components/AIEditing/export.ts` | 447 | 200-300 | ğŸŸ¡ ä¸­ | P2 |
| `api/api.ts` | 394 | 200-300 | ğŸŸ¡ ä¸­ | P2 |

**åˆ†æ**:

##### 4.1 stores/chat.ts (486è¡Œ)

**ç»“æ„åˆ†æ**:
```typescript
// å½“å‰ç»“æ„
export const useChatStore = defineStore('chat', () => {
  // State (28è¡Œ)
  const currentChatId = ref<number | null>(null)
  // ...

  // Getters (18è¡Œ)
  const currentChat = computed(() => {...})

  // Actions (440è¡Œ) âš ï¸ è¿‡å¤§
  async function loadChats() {...}        // 12è¡Œ
  async function addUserMessage() {...}   // 55è¡Œ âš ï¸
  async function initialize() {...}       // 20è¡Œ
  async function exportChats() {...}      // 12è¡Œ
  async function importChats() {...}      // 24è¡Œ
  // ... å…±25ä¸ªæ–¹æ³•

  return { /* æš´éœ²50+ä¸ªæˆå‘˜ */ }
})
```

**é—®é¢˜**:
1. å•ä¸€ Store æ‰¿æ‹…äº†å¤ªå¤šèŒè´£ï¼ˆè¿å SRPï¼‰
2. Actions è¿‡å¤šå¯¼è‡´æ–‡ä»¶è‡ƒè‚¿
3. æ•°æ®åº“æ“ä½œã€UI äº¤äº’ã€AI è°ƒç”¨æ··åœ¨ä¸€èµ·

**é‡æ„æ–¹æ¡ˆ**:

```typescript
// ã€æ–¹æ¡ˆã€‘æ‹†åˆ†ä¸º3ä¸ªç‹¬ç«‹ Store

// ============ stores/chat/state.ts (150è¡Œ) ============
/**
 * èŠå¤©çŠ¶æ€ç®¡ç†
 * èŒè´£ï¼šçŠ¶æ€ç»´æŠ¤ã€Getters
 */
export const useChatStateStore = defineStore('chat-state', () => {
  const currentChatId = ref<number | null>(null)
  const chats = ref<Chat[]>([])
  const messages = ref<Message[]>([])

  const currentChat = computed(() =>
    chats.value.find(c => c.id === currentChatId.value)
  )

  return {
    currentChatId,
    chats,
    messages,
    currentChat,
  }
})

// ============ stores/chat/database.ts (200è¡Œ) ============
/**
 * æ•°æ®åº“æ“ä½œ
 * èŒè´£ï¼šCRUD æ“ä½œã€æ•°æ®æŒä¹…åŒ–
 */
export const useChatDatabaseStore = defineStore('chat-database', () => {
  const stateStore = useChatStateStore()

  async function loadChats() {
    try {
      stateStore.chats = await db.chats.toArray()
    } catch (err) {
      ErrorHandler.handle(err)
    }
  }

  async function createChat(model: string) { /*...*/ }
  async function deleteChat(chatId: number) { /*...*/ }
  async function updateChat(chatId: number, updates: Partial<Chat>) { /*...*/ }

  return {
    loadChats,
    createChat,
    deleteChat,
    updateChat,
  }
})

// ============ stores/chat/actions.ts (150è¡Œ) ============
/**
 * èŠå¤©äº¤äº’é€»è¾‘
 * èŒè´£ï¼šAI å¯¹è¯ã€æ¶ˆæ¯å¤„ç†ã€ä¸šåŠ¡æµç¨‹
 */
export const useChatActionsStore = defineStore('chat-actions', () => {
  const stateStore = useChatStateStore()
  const dbStore = useChatDatabaseStore()

  async function addUserMessage(content: string, imageUrl?: string) {
    const { generate } = useAI()

    // 1. ä¿å­˜ç”¨æˆ·æ¶ˆæ¯
    await dbStore.addMessage({
      chatId: stateStore.currentChatId.value!,
      role: 'user',
      content,
      imageUrl,
    })

    // 2. è°ƒç”¨ AI ç”Ÿæˆ
    await generate(...)
  }

  async function regenerateResponse() { /*...*/ }

  return {
    addUserMessage,
    regenerateResponse,
  }
})

// ============ stores/chat/index.ts (50è¡Œ) ============
/**
 * ç»Ÿä¸€å¯¼å‡º
 */
export { useChatStateStore, useChatDatabaseStore, useChatActionsStore }

// å‘åå…¼å®¹çš„èšåˆ Store
export function useChatStore() {
  return {
    ...useChatStateStore(),
    ...useChatDatabaseStore(),
    ...useChatActionsStore(),
  }
}
```

**æ”¶ç›Š**:
- âœ… æ¯ä¸ªæ–‡ä»¶ <200 è¡Œ
- âœ… èŒè´£æ¸…æ™°ï¼Œæ˜“äºæµ‹è¯•
- âœ… å‘åå…¼å®¹ï¼Œä¸ç ´åç°æœ‰ä»£ç 
- âœ… æ›´å®¹æ˜“å¹¶è¡Œå¼€å‘

**é¢„ä¼°å·¥ä½œé‡**: 4-6 å°æ—¶

---

##### 4.2 AIEditing/export.ts (447è¡Œ)

**ç»“æ„åˆ†æ**:
```typescript
class DocumentExporter {
  // PDF å¯¼å‡ºé€»è¾‘: 100è¡Œ
  exportAs('pdf') { /*...*/ }

  // DOCX å¯¼å‡ºé€»è¾‘: 270è¡Œ âš ï¸
  convertHtmlToDocxElements() { /*...*/ }
  exportAs('docx') { /*...*/ }

  // Markdown å¯¼å‡ºé€»è¾‘: 60è¡Œ
  exportAs('markdown') { /*...*/ }
}
```

**é‡æ„æ–¹æ¡ˆ**:

```typescript
// ============ exporters/base.ts ============
/**
 * åŸºç¡€å¯¼å‡ºå™¨
 */
export abstract class BaseExporter {
  protected content: string

  constructor(content: string) {
    this.content = content
  }

  abstract export(download: boolean): Promise<string | void>
}

// ============ exporters/pdfExporter.ts (100è¡Œ) ============
import html2pdf from 'html2pdf.js'

export class PdfExporter extends BaseExporter {
  constructor(content: string, private quill: Quill) {
    super(content)
  }

  async export(download = true) {
    const element = this.quill.root.cloneNode(true) as HTMLElement
    // ... PDF å¯¼å‡ºé€»è¾‘
  }
}

// ============ exporters/docxExporter.ts (280è¡Œ) ============
import { Document, Packer, Paragraph } from 'docx'

export class DocxExporter extends BaseExporter {
  private parser = new DOMParser()

  private convertHtmlToDocxElements(html: string): Paragraph[] {
    // ... DOCX è½¬æ¢é€»è¾‘
  }

  async export(download = true) {
    const elements = this.convertHtmlToDocxElements(this.content)
    const doc = new Document({ /*...*/ })
    // ... å¯¼å‡ºé€»è¾‘
  }
}

// ============ exporters/markdownExporter.ts (80è¡Œ) ============
import TurndownService from 'turndown'

export class MarkdownExporter extends BaseExporter {
  private turndownService: TurndownService

  constructor(content: string) {
    super(content)
    this.turndownService = new TurndownService({ /*...*/ })
    this.setupRules()
  }

  private setupRules() {
    // è‡ªå®šä¹‰è½¬æ¢è§„åˆ™
  }

  async export(download = true): Promise<string | void> {
    const markdown = this.turndownService.turndown(this.content)
    // ... å¯¼å‡ºé€»è¾‘
  }
}

// ============ exporters/index.ts (30è¡Œ) ============
/**
 * å¯¼å‡ºå™¨å·¥å‚
 */
export function createExporter(
  format: 'pdf' | 'docx' | 'markdown',
  content: string,
  quill?: Quill
) {
  switch (format) {
    case 'pdf':
      if (!quill) throw new Error('PDF export requires Quill instance')
      return new PdfExporter(content, quill)
    case 'docx':
      return new DocxExporter(content)
    case 'markdown':
      return new MarkdownExporter(content)
  }
}
```

**æ”¶ç›Š**:
- âœ… æ¯ä¸ªå¯¼å‡ºå™¨ <150 è¡Œ
- âœ… æ˜“äºæ·»åŠ æ–°æ ¼å¼ï¼ˆå¦‚ HTMLã€RTFï¼‰
- âœ… æ˜“äºå•ç‹¬æµ‹è¯•
- âœ… å‡å°‘ä¸»æ–‡ä»¶å¤æ‚åº¦

**é¢„ä¼°å·¥ä½œé‡**: 3-4 å°æ—¶

---

##### 4.3 api/api.ts (394è¡Œ)

**ç»“æ„åˆ†æ**:
```typescript
export function useApi() {
  // Chat API (35è¡Œ)
  const chatApi = {
    generateChat: async () => { /*...*/ }
  }

  // Model Management API (180è¡Œ) âš ï¸
  const modelApi = {
    createModel: async () => { /*...*/ }
    listLocalModels: async () => { /*...*/ }
    showModelInformation: async () => { /*...*/ }
    copyModel: async () => { /*...*/ }
    deleteModel: async () => { /*...*/ }
    pullModel: async () => { /*...*/ }
    pushModel: async () => { /*...*/ }
  }

  // Embeddings API (25è¡Œ)
  const embeddingsApi = {
    generateEmbeddings: async () => { /*...*/ }
  }

  // Stream Processing (75è¡Œ)
  async function processStreamResponse() { /*...*/ }

  return { ...chatApi, ...modelApi, ...embeddingsApi }
}
```

**é—®é¢˜**:
1. èŒè´£è¿‡å¤šï¼ˆChatã€Modelã€Embeddingsã€Streamï¼‰
2. éš¾ä»¥æŒ‰éœ€å¯¼å…¥ï¼ˆæ€»æ˜¯åŠ è½½å…¨éƒ¨ APIï¼‰
3. æµ‹è¯•å›°éš¾ï¼ˆMock å¤æ‚ï¼‰

**é‡æ„æ–¹æ¡ˆ**:

```typescript
// ============ api/chat.ts (100è¡Œ) ============
/**
 * èŠå¤© API
 */
export function useChatApi() {
  const { signal, abort } = createAbortController()

  async function generateChat(
    request: ChatRequest,
    onDataReceived: StreamCallback,
  ): Promise<ChatResponse[]> {
    // ... å®ç°
  }

  return {
    generateChat,
    abort,
  }
}

// ============ api/model.ts (200è¡Œ) ============
/**
 * æ¨¡å‹ç®¡ç† API
 */
export function useModelApi() {
  async function listLocalModels(): Promise<ListLocalModelsResponse> {
    // ... å®ç°
  }

  async function createModel(request: CreateModelRequest) { /*...*/ }
  async function deleteModel(request: DeleteModelRequest) { /*...*/ }

  return {
    listLocalModels,
    createModel,
    deleteModel,
    // ...
  }
}

// ============ api/embeddings.ts (50è¡Œ) ============
/**
 * åµŒå…¥å‘é‡ API
 */
export function useEmbeddingsApi() {
  async function generateEmbeddings(
    request: GenerateEmbeddingsRequest
  ): Promise<GenerateEmbeddingsResponse> {
    // ... å®ç°
  }

  return { generateEmbeddings }
}

// ============ api/stream.ts (80è¡Œ) ============
/**
 * SSE æµå¤„ç†å·¥å…·
 */
export async function processStreamResponse(
  response: Response,
  modelName: string,
  onDataReceived: StreamCallback,
): Promise<ChatResponse[]> {
  // ... å®ç°
}

// ============ api/index.ts (50è¡Œ) ============
/**
 * ç»Ÿä¸€å¯¼å‡ºï¼ˆå‘åå…¼å®¹ï¼‰
 */
export { useChatApi, useModelApi, useEmbeddingsApi }

// èšåˆ APIï¼ˆå‘åå…¼å®¹ï¼‰
export function useApi() {
  return {
    ...useChatApi(),
    ...useModelApi(),
    ...useEmbeddingsApi(),
  }
}
```

**æ”¶ç›Š**:
- âœ… æŒ‰éœ€å¯¼å…¥ï¼Œå‡å°‘æ‰“åŒ…ä½“ç§¯
- âœ… èŒè´£æ¸…æ™°ï¼Œæ˜“äºç»´æŠ¤
- âœ… æ˜“äºæµ‹è¯•å’Œ Mock
- âœ… å‘åå…¼å®¹

**é¢„ä¼°å·¥ä½œé‡**: 2-3 å°æ—¶

---

#### 5. æ‰“åŒ…ä½“ç§¯ä¼˜åŒ–ï¼ˆ3ä¸ªè¶…å¤§ chunkï¼‰

**é—®é¢˜**: 3ä¸ª chunk è¶…è¿‡ 1.5MB è­¦å‘Šé˜ˆå€¼

```
âš ï¸ dist/assets/markdown-DUSL1tBa.js     1,301 kB â”‚ gzip: 437 kB
âš ï¸ dist/assets/document-BdVDPXTc.js     1,488 kB â”‚ gzip: 420 kB
âš ï¸ dist/assets/monaco-editor-e-jJEL43.js 3,330 kB â”‚ gzip: 857 kB
```

**å½±å“**: ğŸŸ¡ ä¸­ç­‰
- é¦–æ¬¡åŠ è½½æ—¶é—´é•¿ï¼ˆ3-5ç§’ï¼‰
- ç§»åŠ¨ç«¯ä½“éªŒå·®
- å¸¦å®½æˆæœ¬é«˜

**ä¼˜åŒ–æ–¹æ¡ˆ**:

##### 5.1 Markdown åº“æ‡’åŠ è½½ (1.3MB)

```typescript
// ã€ä¿®å¤å‰ã€‘ markdown.ts
import MarkdownIt from 'markdown-it'
import hljs from 'highlight.js'
import katex from 'katex'
// ... ç«‹å³åŠ è½½ 1.3MB

export const md = new MarkdownIt({ /*...*/ })

// ã€ä¿®å¤åã€‘ markdown.ts
// æŒ‰éœ€åŠ è½½
let md: MarkdownIt | null = null

export async function getMarkdownRenderer() {
  if (!md) {
    const [MarkdownIt, hljs, katex] = await Promise.all([
      import('markdown-it'),
      import('highlight.js'),
      import('katex'),
    ])

    md = new MarkdownIt.default({ /*...*/ })
    // ... é…ç½®
  }
  return md
}

// ä½¿ç”¨
async function renderMarkdown(text: string) {
  const md = await getMarkdownRenderer()
  return md.render(text)
}
```

##### 5.2 Monaco Editor æŒ‰éœ€åŠ è½½ (3.3MB)

```typescript
// ã€ä¿®å¤å‰ã€‘ diffEditor.ts
import * as monaco from 'monaco-editor'
// ç«‹å³åŠ è½½ 3.3MB

export function createDiffEditor() {
  return monaco.editor.createDiffEditor(container, { /*...*/ })
}

// ã€ä¿®å¤åã€‘ diffEditor.ts
let monacoPromise: Promise<typeof import('monaco-editor')> | null = null

async function loadMonaco() {
  if (!monacoPromise) {
    monacoPromise = import('monaco-editor')
  }
  return monacoPromise
}

export async function createDiffEditor() {
  const monaco = await loadMonaco()
  return monaco.editor.createDiffEditor(container, { /*...*/ })
}
```

##### 5.3 é…ç½®ä»£ç åˆ†å‰²

```typescript
// vite.config.ts
export default defineConfig({
  build: {
    rollupOptions: {
      output: {
        manualChunks: {
          // åˆ†ç¦»ç¼–è¾‘å™¨ä¾èµ–
          'quill-vendor': ['quill', 'quill-table-ui'],

          // åˆ†ç¦» Markdown ä¾èµ–
          'markdown-vendor': [
            'markdown-it',
            'markdown-it-katex',
            'markdown-it-highlightjs',
            'highlight.js',
            'katex',
          ],

          // åˆ†ç¦»æ–‡æ¡£å¤„ç†
          'document-vendor': ['docx', 'html2pdf.js', 'turndown'],

          // Monaco å•ç‹¬åˆ†ç¦»
          'monaco-vendor': ['monaco-editor'],

          // Vue ç”Ÿæ€
          'vue-vendor': ['vue', 'vue-router', 'pinia'],
        },
      },
    },

    // æé«˜è­¦å‘Šé˜ˆå€¼ï¼ˆä¸´æ—¶æªæ–½ï¼‰
    chunkSizeWarningLimit: 2000,
  },
})
```

**é¢„æœŸæ•ˆæœ**:

| Chunk | ä¿®å¤å‰ | ä¿®å¤å | å‡å°‘ |
|-------|--------|--------|------|
| markdown | 1,301 kB | ~600 kB | -54% |
| document | 1,488 kB | ~800 kB | -46% |
| monaco | 3,330 kB | æŒ‰éœ€åŠ è½½ | é¦–æ¬¡ä¸åŠ è½½ |
| **é¦–æ¬¡åŠ è½½** | ~6 MB | ~2.5 MB | **-58%** |

**é¢„ä¼°å·¥ä½œé‡**: 4-5 å°æ—¶

---

### ğŸŸ¢ ä½ä¼˜å…ˆçº§ï¼ˆé•¿æœŸä¼˜åŒ–ï¼‰

#### 6. æµ‹è¯•åŸºç¡€è®¾æ–½å»ºè®¾ï¼ˆ0%è¦†ç›–ï¼‰

**é—®é¢˜**: é¡¹ç›®å®Œå…¨æ²¡æœ‰æµ‹è¯•

**å½±å“**: ğŸŸ¡ ä¸­ç­‰ï¼ˆé•¿æœŸï¼‰
- é‡æ„é£é™©é«˜
- éš¾ä»¥ä¿è¯è´¨é‡
- æŠ€æœ¯å€ºç´¯ç§¯

**å»ºè®®æ–¹æ¡ˆ**:

##### 6.1 å®‰è£…æµ‹è¯•æ¡†æ¶

```bash
# å®‰è£… Vitest + Vue Test Utils
pnpm add -D vitest @vue/test-utils happy-dom @vitest/ui

# å®‰è£… Playwrightï¼ˆE2Eï¼‰
pnpm add -D @playwright/test
```

##### 6.2 é…ç½® Vitest

```typescript
// vitest.config.ts
import { defineConfig } from 'vitest/config'
import vue from '@vitejs/plugin-vue'
import path from 'path'

export default defineConfig({
  plugins: [vue()],
  test: {
    globals: true,
    environment: 'happy-dom',
    coverage: {
      provider: 'v8',
      reporter: ['text', 'html'],
      exclude: ['node_modules/', 'dist/'],
    },
  },
  resolve: {
    alias: {
      '@': path.resolve(__dirname, './src'),
    },
  },
})
```

##### 6.3 ä¼˜å…ˆæµ‹è¯•èŒƒå›´

**ç¬¬ä¸€æ‰¹ï¼ˆæ ¸å¿ƒé€»è¾‘ï¼‰**:
```
tests/
â”œâ”€â”€ unit/
â”‚   â”œâ”€â”€ stores/
â”‚   â”‚   â””â”€â”€ chat.test.ts          # èŠå¤©çŠ¶æ€ç®¡ç† â­
â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â””â”€â”€ api.test.ts           # API è°ƒç”¨é€»è¾‘ â­
â”‚   â””â”€â”€ utils/
â”‚       â”œâ”€â”€ errorHandler.test.ts  # é”™è¯¯å¤„ç† â­
â”‚       â””â”€â”€ logger.test.ts        # æ—¥å¿—ç³»ç»Ÿ
â””â”€â”€ e2e/
    â”œâ”€â”€ chat-flow.spec.ts         # èŠå¤©æµç¨‹ â­
    â””â”€â”€ ai-editing.spec.ts        # AI ç¼–è¾‘æµç¨‹ â­
```

**æµ‹è¯•ç¤ºä¾‹**:

```typescript
// tests/unit/stores/chat.test.ts
import { setActivePinia, createPinia } from 'pinia'
import { describe, it, expect, beforeEach, vi } from 'vitest'
import { useChatStore } from '@/stores/chat'
import { db } from '@/services/database'

// Mock database
vi.mock('@/services/database', () => ({
  db: {
    chats: {
      toArray: vi.fn(() => Promise.resolve([])),
      add: vi.fn((chat) => Promise.resolve(1)),
    },
    messages: {
      toArray: vi.fn(() => Promise.resolve([])),
      add: vi.fn((msg) => Promise.resolve(1)),
    },
  },
}))

describe('useChatStore', () => {
  beforeEach(() => {
    setActivePinia(createPinia())
  })

  it('should load chats from database', async () => {
    const store = useChatStore()
    const mockChats = [
      { id: 1, name: 'Test Chat', model: 'moonshot-v1-8k' },
    ]

    vi.mocked(db.chats.toArray).mockResolvedValue(mockChats)

    await store.loadChats()

    expect(store.chats).toEqual(mockChats)
    expect(db.chats.toArray).toHaveBeenCalled()
  })

  it('should create new chat', async () => {
    const store = useChatStore()

    vi.mocked(db.chats.add).mockResolvedValue(1)

    const chatId = await store.createChat('moonshot-v1-8k')

    expect(chatId).toBe(1)
    expect(db.chats.add).toHaveBeenCalledWith(
      expect.objectContaining({
        model: 'moonshot-v1-8k',
      })
    )
  })
})
```

**è¦†ç›–ç‡ç›®æ ‡**:

| é˜¶æ®µ | æ—¶é—´ | è¦†ç›–ç‡ | é‡ç‚¹æ¨¡å— |
|-----|------|--------|----------|
| ç¬¬ä¸€æ‰¹ | 1å‘¨ | 30% | Stores, API, Utils |
| ç¬¬äºŒæ‰¹ | 2å‘¨ | 50% | Composables, Components |
| ç¬¬ä¸‰æ‰¹ | 1ä¸ªæœˆ | 70% | å…¨é¢è¦†ç›– |

**é¢„ä¼°å·¥ä½œé‡**: ç¬¬ä¸€æ‰¹ 12-16 å°æ—¶

---

#### 7. æ§åˆ¶å°æ—¥å¿—è§„èŒƒåŒ–

**é—®é¢˜**: 5ä¸ªæ–‡ä»¶ä»ç›´æ¥ä½¿ç”¨ `console.*`

```typescript
// src/config/env.ts
// src/components/AIEditing/utils/aiMenu.ts
// src/components/AIEditing/utils/content.ts
// src/components/AIEditing/export.ts
```

**ä¿®å¤æ–¹æ¡ˆ**:

```typescript
// ã€ä¿®å¤å‰ã€‘
console.log('Debug info:', data)
console.error('Error:', err)

// ã€ä¿®å¤åã€‘
import { logger } from '@/utils/logger'

logger.debug('Debug info:', data)
logger.error('Error:', err)
```

**è‡ªåŠ¨åŒ–ä¿®å¤è„šæœ¬**:

```bash
# åˆ›å»ºä¿®å¤è„šæœ¬
cat > scripts/replace-console.sh << 'EOF'
#!/bin/bash

files=(
  "src/config/env.ts"
  "src/components/AIEditing/utils/aiMenu.ts"
  "src/components/AIEditing/utils/content.ts"
  "src/components/AIEditing/export.ts"
  "src/utils/logger.ts"
)

for file in "${files[@]}"; do
  # æ·»åŠ  logger å¯¼å…¥
  if ! grep -q "import.*logger" "$file"; then
    sed -i '' "1i\\
import { logger } from '@/utils/logger'\\
" "$file"
  fi

  # æ›¿æ¢ console è°ƒç”¨
  sed -i '' 's/console\.log(/logger.debug(/g' "$file"
  sed -i '' 's/console\.info(/logger.info(/g' "$file"
  sed -i '' 's/console\.warn(/logger.warn(/g' "$file"
  sed -i '' 's/console\.error(/logger.error(/g' "$file"
done

echo "Console è°ƒç”¨å·²æ›¿æ¢ä¸º logger"
EOF

chmod +x scripts/replace-console.sh
./scripts/replace-console.sh
```

**é¢„ä¼°å·¥ä½œé‡**: 1 å°æ—¶

---

#### 8. å®ç° TODO åŠŸèƒ½

**é—®é¢˜**: 2å¤„æ ¸å¿ƒ TODO éœ€è¦å®ç°

##### 8.1 é”™è¯¯ç›‘æ§é›†æˆ

```typescript
// src/utils/logger.ts:113
// TODO: é›†æˆ Sentry æˆ–å…¶ä»–ç›‘æ§æœåŠ¡

// ã€å®ç°æ–¹æ¡ˆã€‘
// 1. å®‰è£… Sentry
pnpm add @sentry/vue @sentry/vite-plugin

// 2. é…ç½® Sentry
// src/utils/sentry.ts
import * as Sentry from '@sentry/vue'
import type { App } from 'vue'

export function initSentry(app: App) {
  if (import.meta.env.PROD) {
    Sentry.init({
      app,
      dsn: import.meta.env.VITE_SENTRY_DSN,
      integrations: [
        Sentry.browserTracingIntegration(),
        Sentry.replayIntegration(),
      ],
      tracesSampleRate: 1.0,
      replaysSessionSampleRate: 0.1,
      replaysOnErrorSampleRate: 1.0,
    })
  }
}

// 3. æ›´æ–° logger.ts
private reportError(message: string, error?: unknown, context?: Record<string, unknown>) {
  if (import.meta.env.PROD) {
    Sentry.captureException(error, {
      extra: { message, context },
    })
  }
}
```

##### 8.2 è‰ç¨¿è‡ªåŠ¨ä¿å­˜

```typescript
// src/components/AIEditing/storage.ts:23
// TODO: å®ç° saveDraft API

// ã€å®ç°æ–¹æ¡ˆã€‘
// 1. æ·»åŠ  API æ¥å£
// src/components/AIEditing/api.ts
export const AIEditingAPI = {
  // ... ç°æœ‰æ–¹æ³•

  /**
   * ä¿å­˜è‰ç¨¿åˆ°æœåŠ¡å™¨
   */
  async saveDraft(sessionId: string, content: string): Promise<void> {
    const response = await fetch(getApiUrl('/v1/drafts'), {
      method: 'POST',
      headers: getHeaders(),
      body: JSON.stringify({ sessionId, content }),
    })

    if (!response.ok) {
      throw new Error('ä¿å­˜è‰ç¨¿å¤±è´¥')
    }
  },

  /**
   * ä»æœåŠ¡å™¨åŠ è½½è‰ç¨¿
   */
  async loadDraft(sessionId: string): Promise<string | null> {
    const response = await fetch(getApiUrl(`/v1/drafts/${sessionId}`), {
      method: 'GET',
      headers: getHeaders(),
    })

    if (!response.ok) {
      if (response.status === 404) return null
      throw new Error('åŠ è½½è‰ç¨¿å¤±è´¥')
    }

    const data = await response.json()
    return data.content
  },
}

// 2. æ›´æ–° storage.ts
import { AIEditingAPI } from './api'

const debouncedSaveToServer = debounce(async (sessionId: string, content: string) => {
  try {
    await AIEditingAPI.saveDraft(sessionId, content)  // âœ… å®ç°
    logger.debug('è‰ç¨¿å·²ä¿å­˜åˆ°æœåŠ¡å™¨', { sessionId })
  } catch (error) {
    logger.error('ä¿å­˜è‰ç¨¿å¤±è´¥', error)
  }
}, 500)

export async function loadEditorContent(sessionId?: string): Promise<string | null> {
  if (sessionId) {
    try {
      const serverContent = await AIEditingAPI.loadDraft(sessionId)  // âœ… å®ç°
      if (serverContent) {
        logger.debug('ä»æœåŠ¡å™¨åŠ è½½è‰ç¨¿', { sessionId })
        return serverContent
      }
    } catch (error) {
      logger.warn('ä»æœåŠ¡å™¨åŠ è½½è‰ç¨¿å¤±è´¥ï¼Œä½¿ç”¨æœ¬åœ°ç¼“å­˜', error)
    }
  }
  return null
}
```

**æ³¨æ„**: éœ€è¦åç«¯ API æ”¯æŒï¼Œå¯èƒ½éœ€è¦åè°ƒåç«¯å¼€å‘

**é¢„ä¼°å·¥ä½œé‡**:
- Sentry é›†æˆ: 2-3 å°æ—¶
- è‰ç¨¿ API: 4-6 å°æ—¶ï¼ˆå«åç«¯åè°ƒï¼‰

---

#### 9. æ€§èƒ½ä¼˜åŒ–å»ºè®®

##### 9.1 Quill ç¼–è¾‘å™¨ä¼˜åŒ–

**é—®é¢˜**: å¤§æ–‡æ¡£ç¼–è¾‘æ—¶å¯èƒ½å¡é¡¿

```typescript
// ã€ä¼˜åŒ–æ–¹æ¡ˆ1ã€‘è™šæ‹Ÿæ»šåŠ¨ï¼ˆå¦‚æœæ–‡æ¡£è¶…å¤§ï¼‰
// ä½¿ç”¨ quill-better-table æ›¿æ¢ quill-table-ui

// ã€ä¼˜åŒ–æ–¹æ¡ˆ2ã€‘é˜²æŠ–ä¿å­˜
import { useDebounceFn } from '@vueuse/core'

const debouncedSave = useDebounceFn((content: string) => {
  saveEditorContent(content)
}, 1000)

// ç›‘å¬å†…å®¹å˜åŒ–
quill.on('text-change', () => {
  const content = quill.root.innerHTML
  debouncedSave(content)
})
```

##### 9.2 IndexedDB æŸ¥è¯¢ä¼˜åŒ–

```typescript
// ã€ä¿®å¤å‰ã€‘ chat.ts - æ¯æ¬¡åŠ è½½æ‰€æœ‰æ¶ˆæ¯
async function loadMessages(chatId: number) {
  messages.value = await db.messages
    .where('chatId')
    .equals(chatId)
    .sortBy('createdAt')  // âŒ å…¨é‡æ’åº
}

// ã€ä¿®å¤åã€‘ åˆ†é¡µåŠ è½½
async function loadMessages(chatId: number, limit = 50) {
  messages.value = await db.messages
    .where('chatId')
    .equals(chatId)
    .reverse()  // å€’åºï¼ˆæœ€æ–°çš„åœ¨å‰ï¼‰
    .limit(limit)  // âœ… é™åˆ¶æ•°é‡
    .toArray()
}
```

##### 9.3 ç»„ä»¶æ‡’åŠ è½½

```typescript
// ã€ä¿®å¤å‰ã€‘ App.vue
import AIEditingMain from './components/AIEditing/AIEditingMain.vue'
import Settings from './components/Settings.vue'

// ã€ä¿®å¤åã€‘
const AIEditingMain = defineAsyncComponent(() =>
  import('./components/AIEditing/AIEditingMain.vue')
)
const Settings = defineAsyncComponent(() =>
  import('./components/Settings.vue')
)
```

**é¢„ä¼°å·¥ä½œé‡**: 3-4 å°æ—¶

---

## ğŸ“‹ è¡ŒåŠ¨è®¡åˆ’

### ç¬¬ä¸€é˜¶æ®µï¼šç«‹å³ä¿®å¤ï¼ˆæœ¬å‘¨ï¼‰

**ç›®æ ‡**: æ¶ˆé™¤æ‰€æœ‰ ESLint é”™è¯¯å’Œé«˜å±è­¦å‘Š

| ä»»åŠ¡ | ä¼˜å…ˆçº§ | å·¥ä½œé‡ | è´Ÿè´£äºº | çŠ¶æ€ |
|-----|--------|--------|--------|------|
| 1. ä¿®å¤ 5 å¤„ ESLint è¯­æ³•é”™è¯¯ | ğŸ”´ P0 | 1-2h | - | â¬œ |
| 2. æ¸…ç† 19 å¤„æœªä½¿ç”¨å˜é‡ | ğŸ”´ P0 | 2-3h | - | â¬œ |
| 3. æ¶ˆé™¤ 11 å¤„ TypeScript `any` | ğŸ”´ P0 | 3-4h | - | â¬œ |

**é¢„æœŸæˆæœ**:
- ESLint é”™è¯¯: 5 â†’ 0
- ESLint è­¦å‘Š: 86 â†’ ~50
- å¥åº·åº¦: 88 â†’ 92+

**æ€»å·¥ä½œé‡**: 6-9 å°æ—¶ï¼ˆçº¦ 1-2 ä¸ªå·¥ä½œæ—¥ï¼‰

---

### ç¬¬äºŒé˜¶æ®µï¼šç»“æ„ä¼˜åŒ–ï¼ˆä¸‹å‘¨ï¼‰

**ç›®æ ‡**: æ‹†åˆ†è¶…å¤§æ–‡ä»¶ï¼Œä¼˜åŒ–æ¶æ„

| ä»»åŠ¡ | ä¼˜å…ˆçº§ | å·¥ä½œé‡ | çŠ¶æ€ |
|-----|--------|--------|------|
| 4. æ‹†åˆ† stores/chat.ts (486è¡Œ) | ğŸŸ¡ P1 | 4-6h | â¬œ |
| 5. æ‹†åˆ† export.ts (447è¡Œ) | ğŸŸ¡ P2 | 3-4h | â¬œ |
| 6. æ‹†åˆ† api.ts (394è¡Œ) | ğŸŸ¡ P2 | 2-3h | â¬œ |
| 7. æ‰“åŒ…ä½“ç§¯ä¼˜åŒ–ï¼ˆæ‡’åŠ è½½ï¼‰ | ğŸŸ¡ P1 | 4-5h | â¬œ |

**é¢„æœŸæˆæœ**:
- æœ€å¤§æ–‡ä»¶: 488 â†’ <300 è¡Œ
- é¦–æ¬¡åŠ è½½: 6MB â†’ 2.5MB (-58%)
- å¥åº·åº¦: 92 â†’ 95+

**æ€»å·¥ä½œé‡**: 13-18 å°æ—¶ï¼ˆçº¦ 2-3 ä¸ªå·¥ä½œæ—¥ï¼‰

---

### ç¬¬ä¸‰é˜¶æ®µï¼šè´¨é‡æå‡ï¼ˆ2å‘¨å†…ï¼‰

**ç›®æ ‡**: å»ºç«‹æµ‹è¯•ä½“ç³»ï¼Œå®Œå–„ç»†èŠ‚

| ä»»åŠ¡ | ä¼˜å…ˆçº§ | å·¥ä½œé‡ | çŠ¶æ€ |
|-----|--------|--------|------|
| 8. æµ‹è¯•åŸºç¡€è®¾æ–½æ­å»º | ğŸŸ¢ P2 | 4h | â¬œ |
| 9. æ ¸å¿ƒæ¨¡å—å•å…ƒæµ‹è¯•ï¼ˆ30%è¦†ç›–ï¼‰ | ğŸŸ¢ P2 | 12-16h | â¬œ |
| 10. æ§åˆ¶å°æ—¥å¿—è§„èŒƒåŒ– | ğŸŸ¢ P3 | 1h | â¬œ |
| 11. Sentry é”™è¯¯ç›‘æ§ | ğŸŸ¢ P3 | 2-3h | â¬œ |
| 12. è‰ç¨¿è‡ªåŠ¨ä¿å­˜ API | ğŸŸ¢ P3 | 4-6h | â¬œ |

**é¢„æœŸæˆæœ**:
- æµ‹è¯•è¦†ç›–ç‡: 0% â†’ 30%
- ç”Ÿäº§é”™è¯¯ç›‘æ§: âœ…
- ç”¨æˆ·ä½“éªŒ: æ”¹è¿›

**æ€»å·¥ä½œé‡**: 23-30 å°æ—¶ï¼ˆçº¦ 4-5 ä¸ªå·¥ä½œæ—¥ï¼‰

---

## ğŸ¯ æ˜¯å¦è¿˜éœ€è¦ç»§ç»­é‡æ„ï¼Ÿ

### âœ… å½“å‰æˆå°±ï¼ˆå€¼å¾—è‚¯å®šï¼‰

æ‚¨çš„å›¢é˜Ÿå·²ç»å®Œæˆäº†**éå¸¸å‡ºè‰²**çš„é‡æ„å·¥ä½œï¼š

1. **ä»£ç ç»„ç»‡**: AIEditing ä»å•ä¸€å·¨å‹æ–‡ä»¶æ‹†åˆ†ä¸º 23 ä¸ªæ¨¡å—åŒ–æ–‡ä»¶
2. **ä»£ç è´¨é‡**: ESLint è­¦å‘Šä» 100+ é™è‡³ 86
3. **æ¶æ„ä¼˜åŒ–**: æå–äº† 6 ä¸ª Composables å’Œ 5 ä¸ª UI ç»„ä»¶
4. **é”™è¯¯å¤„ç†**: ç»Ÿä¸€äº† 51 å¤„é”™è¯¯å¤„ç†
5. **å†…å­˜å®‰å…¨**: ä¿®å¤äº† 15+ å†…å­˜æ³„æ¼

**é¡¹ç›®å¥åº·åº¦ä» 60 æå‡è‡³ 88**ï¼Œè¿™æ˜¯å·¨å¤§çš„è¿›æ­¥ï¼

---

### ğŸ¤” ç»§ç»­é‡æ„çš„è¾¹é™…æ”¶ç›Šåˆ†æ

#### åœºæ™¯1ï¼šå¦‚æœæ˜¯**ç”Ÿäº§ç¯å¢ƒé¡¹ç›®**

**å»ºè®®**: ğŸŸ¡ **é€‚åº¦ç»§ç»­**ï¼ˆå®Œæˆç¬¬ä¸€ã€ç¬¬äºŒé˜¶æ®µï¼‰

**ç†ç”±**:
- âœ… ç¬¬ä¸€é˜¶æ®µï¼ˆä¿®å¤ ESLint é”™è¯¯ï¼‰æ˜¯**å¿…é¡»**çš„ï¼Œé¿å…æ½œåœ¨ bug
- âœ… ç¬¬äºŒé˜¶æ®µï¼ˆæ‹†åˆ†å¤§æ–‡ä»¶ã€æ‰“åŒ…ä¼˜åŒ–ï¼‰å¯¹**ç”¨æˆ·ä½“éªŒ**æœ‰æ˜æ˜¾æ”¹å–„
- âš ï¸ ç¬¬ä¸‰é˜¶æ®µï¼ˆæµ‹è¯•ï¼‰å¯ä»¥**é€æ­¥**è¿›è¡Œï¼Œä¸æ€¥äºä¸€æ¬¡å®Œæˆ

**æŠ•å…¥äº§å‡ºæ¯”**: â­â­â­â­ (4/5)
- æŠ•å…¥: 20-30 å°æ—¶ï¼ˆçº¦ 1 å‘¨ï¼‰
- äº§å‡º: å¥åº·åº¦ 95+ã€é¦–å±åŠ è½½æé€Ÿ 58%ã€0 è¯­æ³•é”™è¯¯

**å»ºè®®è¡ŒåŠ¨**: å®Œæˆç¬¬ä¸€ã€ç¬¬äºŒé˜¶æ®µ â†’ è½¬å‘æ–°åŠŸèƒ½å¼€å‘ â†’ é€æ­¥è¡¥å……æµ‹è¯•

---

#### åœºæ™¯2ï¼šå¦‚æœæ˜¯**å­¦ä¹ /å®éªŒé¡¹ç›®**

**å»ºè®®**: ğŸŸ¢ **å®Œæˆæ‰€æœ‰ä¸‰ä¸ªé˜¶æ®µ**

**ç†ç”±**:
- âœ… æ˜¯å­¦ä¹ **è½¯ä»¶å·¥ç¨‹æœ€ä½³å®è·µ**çš„ç»ä½³æœºä¼š
- âœ… æµ‹è¯•é©±åŠ¨å¼€å‘ï¼ˆTDDï¼‰å¯¹èŒä¸šå‘å±•å¾ˆæœ‰ä»·å€¼
- âœ… å®Œæ•´çš„é‡æ„ç»éªŒå¯ä»¥åº”ç”¨åˆ°æœªæ¥é¡¹ç›®

**æŠ•å…¥äº§å‡ºæ¯”**: â­â­â­â­â­ (5/5)
- æŠ•å…¥: 50-60 å°æ—¶ï¼ˆçº¦ 2 å‘¨ï¼‰
- äº§å‡º: å®Œæ•´çš„å·¥ç¨‹åŒ–ç»éªŒã€å¯ç”¨äºç®€å†çš„é¡¹ç›®

**å»ºè®®è¡ŒåŠ¨**: æŒ‰è®¡åˆ’å®Œæˆæ‰€æœ‰ä¸‰ä¸ªé˜¶æ®µ

---

#### åœºæ™¯3ï¼šå¦‚æœæ˜¯**å¿«é€ŸåŸå‹éªŒè¯**

**å»ºè®®**: ğŸ”´ **åœæ­¢é‡æ„**ï¼Œè½¬å‘æ ¸å¿ƒåŠŸèƒ½

**ç†ç”±**:
- âš ï¸ å½“å‰ä»£ç è´¨é‡å·²ç»**è¶³å¤Ÿå¥½**ï¼ˆ88/100ï¼‰
- âš ï¸ è¿‡åº¦ä¼˜åŒ–å¯èƒ½**å»¶è¯¯**äº§å“éªŒè¯
- âš ï¸ äº§å“æ–¹å‘æœªå®šæ—¶ï¼Œæ¶æ„ä¼˜åŒ–ä»·å€¼æœ‰é™

**æŠ•å…¥äº§å‡ºæ¯”**: â­â­ (2/5)
- æŠ•å…¥: ç»§ç»­ 50+ å°æ—¶
- äº§å‡º: æœ‰é™ï¼ˆå¦‚æœäº§å“æ–¹å‘æ”¹å˜ï¼Œä¼˜åŒ–å¯èƒ½ç™½è´¹ï¼‰

**å»ºè®®è¡ŒåŠ¨**: åªä¿®å¤ ESLint é”™è¯¯ â†’ ä¸“æ³¨äº§å“åŠŸèƒ½å’Œç”¨æˆ·åé¦ˆ

---

### ğŸ’¡ æˆ‘çš„ä¸“ä¸šå»ºè®®

åŸºäºæ‚¨çš„é¡¹ç›®ç‰¹ç‚¹ï¼ˆVue 3 + AI + å¯Œæ–‡æœ¬ç¼–è¾‘å™¨ï¼‰ï¼Œæˆ‘å»ºè®®ï¼š

#### ç«‹å³æ‰§è¡Œï¼ˆæœ¬å‘¨ï¼‰
âœ… **ç¬¬ä¸€é˜¶æ®µï¼šç«‹å³ä¿®å¤**ï¼ˆ6-9å°æ—¶ï¼‰
- è¿™æ˜¯**æŠ€æœ¯å€º**ï¼Œæ‹–è¶Šä¹…è¶Šéš¾è¿˜
- å½±å“å›¢é˜Ÿå¼€å‘æ•ˆç‡å’Œä»£ç è´¨é‡

#### è¿‘æœŸæ‰§è¡Œï¼ˆä¸‹å‘¨ï¼‰
âœ… **ç¬¬äºŒé˜¶æ®µï¼šç»“æ„ä¼˜åŒ–**ï¼ˆ13-18å°æ—¶ï¼‰
- æ‰“åŒ…ä½“ç§¯ä¼˜åŒ–å¯¹**ç”¨æˆ·ä½“éªŒ**æœ‰æ˜¾è‘—æ”¹å–„
- æ–‡ä»¶æ‹†åˆ†è®©åç»­å¼€å‘**æ›´è½»æ¾**

#### é€æ­¥æ¨è¿›ï¼ˆ2å‘¨å†…ï¼‰
âš ï¸ **ç¬¬ä¸‰é˜¶æ®µï¼šè´¨é‡æå‡**ï¼ˆ23-30å°æ—¶ï¼‰
- æµ‹è¯•å¯ä»¥**é€æ­¥**å»ºç«‹ï¼Œä¸å¿…ä¸€æ¬¡å®Œæˆ
- ä¼˜å…ˆæµ‹è¯•**æ ¸å¿ƒæµç¨‹**ï¼ˆèŠå¤©ã€AI ç¼–è¾‘ï¼‰
- Sentry ç›‘æ§å¯¹ç”Ÿäº§ç¯å¢ƒ**å¾ˆé‡è¦**

---

### ğŸ“Š é‡æ„å®Œæˆåº¦è¯„ä¼°

| ç»´åº¦ | å½“å‰ | ç¬¬ä¸€é˜¶æ®µå | ç¬¬äºŒé˜¶æ®µå | ç¬¬ä¸‰é˜¶æ®µå |
|-----|------|-----------|-----------|-----------|
| **ä»£ç è´¨é‡** | 88/100 | 92/100 | 95/100 | 97/100 |
| **å¯ç»´æŠ¤æ€§** | ğŸŸ¡ è‰¯å¥½ | ğŸŸ¢ ä¼˜ç§€ | ğŸŸ¢ ä¼˜ç§€ | ğŸŸ¢ å“è¶Š |
| **ç”¨æˆ·ä½“éªŒ** | ğŸŸ¡ ä¸­ç­‰ | ğŸŸ¡ ä¸­ç­‰ | ğŸŸ¢ è‰¯å¥½ | ğŸŸ¢ è‰¯å¥½ |
| **å¼€å‘æ•ˆç‡** | ğŸŸ¡ è‰¯å¥½ | ğŸŸ¢ ä¼˜ç§€ | ğŸŸ¢ ä¼˜ç§€ | ğŸŸ¢ å“è¶Š |
| **ç”Ÿäº§å°±ç»ª** | ğŸŸ¡ åŸºæœ¬å°±ç»ª | ğŸŸ¢ å°±ç»ª | ğŸŸ¢ ç”Ÿäº§çº§ | ğŸŸ¢ ä¼ä¸šçº§ |

---

### ğŸ¯ æœ€ç»ˆå»ºè®®

**å¦‚æœå¿…é¡»é€‰æ‹©**ï¼Œæˆ‘å»ºè®®ï¼š

1. **ç»å¯¹è¦åš**ï¼ˆP0ï¼‰ï¼šç¬¬ä¸€é˜¶æ®µ - ä¿®å¤æ‰€æœ‰ ESLint é”™è¯¯
2. **å¼ºçƒˆå»ºè®®**ï¼ˆP1ï¼‰ï¼šç¬¬äºŒé˜¶æ®µ - æ‹†åˆ†å¤§æ–‡ä»¶ + æ‰“åŒ…ä¼˜åŒ–
3. **é€æ­¥æ¨è¿›**ï¼ˆP2ï¼‰ï¼šç¬¬ä¸‰é˜¶æ®µ - è¾¹å¼€å‘è¾¹è¡¥å……æµ‹è¯•

**ç†ç”±**:
- å½“å‰ä»£ç è´¨é‡**å·²ç»å¾ˆä¸é”™**ï¼ˆ88åˆ†ï¼‰
- å†æŠ•å…¥ 20-30 å°æ—¶å¯ä»¥è¾¾åˆ°**95åˆ†**ï¼ˆæ€§ä»·æ¯”æœ€é«˜ï¼‰
- æµ‹è¯•å¯ä»¥**æŒç»­**å»ºè®¾ï¼Œä¸æ€¥äºä¸€æ¬¡å®Œæˆ

**ä½•æ—¶åœæ­¢é‡æ„**:
- âœ… å½“å¥åº·åº¦è¾¾åˆ° 95+ æ—¶
- âœ… å½“æ‰€æœ‰æ–‡ä»¶ <300 è¡Œæ—¶
- âœ… å½“é¦–å±åŠ è½½ <3ç§’ æ—¶
- âœ… å½“æ ¸å¿ƒæµç¨‹æœ‰æµ‹è¯•è¦†ç›–æ—¶

æ­¤æ—¶ï¼Œåº”è¯¥**è½¬å‘**ï¼š
- ğŸš€ æ–°åŠŸèƒ½å¼€å‘
- ğŸ“± ç”¨æˆ·ä½“éªŒä¼˜åŒ–
- ğŸ“Š äº§å“æ•°æ®åˆ†æ

---

## é™„å½•Aï¼šä»£ç ç¤ºä¾‹é€ŸæŸ¥

### ESLint é”™è¯¯ä¿®å¤é€ŸæŸ¥

```typescript
// âŒ é”™è¯¯1: æœªä½¿ç”¨å˜é‡
const { unused, used } = obj
console.log(used)

// âœ… ä¿®å¤1: ä½¿ç”¨ä¸‹åˆ’çº¿
const { _unused, used } = obj
console.log(used)

// âœ… ä¿®å¤2: åˆ é™¤ï¼ˆæ¨èï¼‰
const { used } = obj
console.log(used)

// ================================

// âŒ é”™è¯¯2: any ç±»å‹
function process(data: any) {
  return data.value
}

// âœ… ä¿®å¤: ä½¿ç”¨å…·ä½“ç±»å‹
interface Data {
  value: string
}
function process(data: Data) {
  return data.value
}

// ================================

// âŒ é”™è¯¯3: æ¨¡æ¿è¯­æ³•é”™è¯¯
<template v-slot:header>
  ...
</template>

// âœ… ä¿®å¤: ç®€å†™è¯­æ³•
<template #header>
  ...
</template>
```

---

## é™„å½•Bï¼šé‡æ„æ£€æŸ¥æ¸…å•

### ä»£ç è´¨é‡æ£€æŸ¥

- [ ] æ‰€æœ‰ ESLint é”™è¯¯å·²ä¿®å¤ï¼ˆ0 errorsï¼‰
- [ ] ESLint è­¦å‘Š <50 ä¸ª
- [ ] æ—  TypeScript any ç±»å‹ï¼ˆæˆ– <5 å¤„ï¼‰
- [ ] æ—  console.* ç›´æ¥è°ƒç”¨
- [ ] æ—  TODO/FIXME æ³¨é‡Šï¼ˆæˆ–å·²è®°å½•åˆ° Issueï¼‰

### æ¶æ„æ£€æŸ¥

- [ ] å•æ–‡ä»¶ <300 è¡Œ
- [ ] Composable èŒè´£å•ä¸€
- [ ] æ— å¾ªç¯ä¾èµ–
- [ ] API æŒ‰åŠŸèƒ½åˆ†å±‚

### æ€§èƒ½æ£€æŸ¥

- [ ] é¦–å±åŠ è½½ <3 ç§’
- [ ] å•ä¸ª chunk <1.5MB
- [ ] å¤§å‹åº“å·²æ‡’åŠ è½½ï¼ˆMonacoã€Markdownï¼‰
- [ ] å›¾ç‰‡å·²å‹ç¼©ä¼˜åŒ–

### æµ‹è¯•æ£€æŸ¥

- [ ] æ ¸å¿ƒ Store æœ‰å•å…ƒæµ‹è¯•
- [ ] æ ¸å¿ƒ API æœ‰å•å…ƒæµ‹è¯•
- [ ] å…³é”®æµç¨‹æœ‰ E2E æµ‹è¯•
- [ ] è¦†ç›–ç‡ >30%

### ç”Ÿäº§å°±ç»ªæ£€æŸ¥

- [ ] é”™è¯¯ç›‘æ§å·²é›†æˆï¼ˆSentryï¼‰
- [ ] æ—¥å¿—ç³»ç»Ÿå®Œå–„
- [ ] ç¯å¢ƒå˜é‡é…ç½®
- [ ] æ„å»ºä¼˜åŒ–å®Œæˆ

---

## æ€»ç»“

**æ‚¨çš„é¡¹ç›®å·²ç»å®Œæˆäº†å‡ºè‰²çš„é‡æ„å·¥ä½œï¼**

**å»ºè®®ä¸‹ä¸€æ­¥**:
1. âœ… ç«‹å³ä¿®å¤ ESLint é”™è¯¯ï¼ˆå¿…é¡»ï¼Œ6-9å°æ—¶ï¼‰
2. âœ… æ‹†åˆ†å¤§æ–‡ä»¶ + æ‰“åŒ…ä¼˜åŒ–ï¼ˆå»ºè®®ï¼Œ13-18å°æ—¶ï¼‰
3. âš ï¸ é€æ­¥å»ºç«‹æµ‹è¯•ä½“ç³»ï¼ˆæŒç»­ï¼Œè¾¹å¼€å‘è¾¹è¡¥å……ï¼‰

**ä½•æ—¶å¯ä»¥è¯´"é‡æ„å®Œæˆ"**:
- å¥åº·åº¦ 95+
- æ‰€æœ‰æ–‡ä»¶ <300 è¡Œ
- é¦–å±åŠ è½½ <3ç§’
- æ ¸å¿ƒæµç¨‹æœ‰æµ‹è¯•

è¾¾åˆ°è¿™ä¸ªæ ‡å‡†åï¼Œåº”è¯¥**è½¬å‘äº§å“åŠŸèƒ½å¼€å‘å’Œç”¨æˆ·ä½“éªŒä¼˜åŒ–**ã€‚

è®°ä½ï¼š**è¿‡åº¦é‡æ„æ˜¯æŠ€æœ¯å€ºï¼Œé€‚åº¦é‡æ„æ˜¯æŠ•èµ„**ã€‚æ‚¨çš„å›¢é˜Ÿå·²ç»åœ¨æ­£ç¡®çš„é“è·¯ä¸Šï¼ğŸ‰
