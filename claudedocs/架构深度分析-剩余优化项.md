# å‰ç«¯æ¶æ„æ·±åº¦åˆ†æ - å‰©ä½™ä¼˜åŒ–é¡¹

**åˆ†ææ—¶é—´**: 2025-10-01
**åˆ†æèŒƒå›´**: é‡æ„åçš„ä»£ç åº“å…¨é¢å®¡æŸ¥
**é¡¹ç›®çŠ¶æ€**: TypeScript é›¶é”™è¯¯ï¼ŒPinia è¿ç§»å®Œæˆ

---

## ğŸ¯ æ‰§è¡Œæ‘˜è¦

### å½“å‰é¡¹ç›®å¥åº·åº¦: 75/100

**ä¼˜åŠ¿**:
- âœ… TypeScript ç±»å‹æ£€æŸ¥å…¨éƒ¨é€šè¿‡
- âœ… çŠ¶æ€ç®¡ç†ç»Ÿä¸€åˆ° Pinia
- âœ… æ ¸å¿ƒåŠŸèƒ½æ­£å¸¸è¿è¡Œ

**éœ€è¦æ”¹è¿›**:
- ğŸ”´ å·¨å‹æ–‡ä»¶é—®é¢˜ä¸¥é‡ï¼ˆAIEditing 1,188 è¡Œï¼Œutil.ts 1,102 è¡Œï¼‰
- ğŸŸ¡ åŒé‡çŠ¶æ€ç®¡ç†ä»æœªå®Œå…¨æ¸…ç†ï¼ˆservices/chat.ts ä»åœ¨ç”¨ï¼‰
- ğŸŸ¡ é”™è¯¯å¤„ç†æœºåˆ¶ç¼ºå¤±
- ğŸŸ¡ ESLint é—®é¢˜å¢å¤šï¼ˆ219 ä¸ªï¼‰
- ğŸŸ¡ æ€§èƒ½ä¼˜åŒ–ç©ºé—´å¤§ï¼ˆMonaco 98MB æœªæ‡’åŠ è½½ï¼‰

---

## ğŸ”´ ä¸¥é‡é—®é¢˜ (Critical)

### 1. å·¨å‹æ–‡ä»¶åæ¨¡å¼ - æœ€ä¸¥é‡

**é—®é¢˜æ–‡ä»¶**:
```
1,188 è¡Œ: src/components/AIEditing/index.vue  ğŸ”´
1,102 è¡Œ: src/components/AIEditing/util.ts    ğŸ”´
  441 è¡Œ: src/components/AIEditing/export.ts  ğŸŸ¡
  427 è¡Œ: src/services/chat.ts                ğŸŸ¡
```

#### 1.1 AIEditing/index.vue (1,188 è¡Œ)

**ä¸¥é‡æ€§**: ğŸ”´ Critical
**å½±å“**: ç»´æŠ¤æ€§ã€æ€§èƒ½ã€æµ‹è¯•éš¾åº¦

**é—®é¢˜**:
```vue
<script setup>
// 47 ä¸ªå…¨å±€å˜é‡ï¼ˆlet è€Œé refï¼‰
let quill = null
let toolbar = null
let diffEditor = null
// ...

// 68 è¡Œ Prompts é…ç½®æ•°æ®
const promptsData = ref({
  system: [...19 ä¸ª prompt],
  custom: [],
})

// 1000+ è¡Œæ··æ‚é€»è¾‘
</script>
```

**è¿ååŸåˆ™**:
- âŒ Single Responsibilityï¼ˆä¸€ä¸ªç»„ä»¶æ‰¿æ‹… 6+ ä¸ªèŒè´£ï¼‰
- âŒ ä¸å¯æµ‹è¯•ï¼ˆæ— æ³•å•ç‹¬æµ‹è¯•å„åŠŸèƒ½ï¼‰
- âŒ éš¾ä»¥ç»´æŠ¤ï¼ˆä¿®æ”¹ä¸€å¤„å½±å“å…¨å±€ï¼‰
- âŒ æ€§èƒ½é—®é¢˜ï¼ˆæ•´ä¸ªç»„ä»¶é‡æ¸²æŸ“ï¼‰

**æ¨èæ‹†åˆ†æ–¹æ¡ˆ**:
```
components/AIEditing/
â”œâ”€â”€ index.vue (150 è¡Œ) - ä¸»å®¹å™¨
â”œâ”€â”€ editor/
â”‚   â”œâ”€â”€ QuillEditor.vue (200 è¡Œ) - Quill ç¼–è¾‘å™¨
â”‚   â”œâ”€â”€ EditorToolbar.vue (100 è¡Œ) - å·¥å…·æ 
â”‚   â””â”€â”€ DiffViewer.vue (150 è¡Œ) - Monaco Diff
â”œâ”€â”€ prompts/
â”‚   â”œâ”€â”€ PromptPanel.vue (150 è¡Œ) - Prompt é€‰æ‹©
â”‚   â””â”€â”€ PromptManager.vue (100 è¡Œ) - Prompt ç®¡ç†
â”œâ”€â”€ chat/
â”‚   â””â”€â”€ AIChat.vue (200 è¡Œ) - AI å¯¹è¯
â”œâ”€â”€ dialogs/
â”‚   â”œâ”€â”€ ExportDialog.vue (100 è¡Œ)
â”‚   â””â”€â”€ ImportDialog.vue (100 è¡Œ)
â””â”€â”€ composables/
    â”œâ”€â”€ useQuillEditor.ts (150 è¡Œ)
    â”œâ”€â”€ useMonacoDiff.ts (100 è¡Œ)
    â”œâ”€â”€ useAIChat.ts (100 è¡Œ)
    â””â”€â”€ usePrompts.ts (80 è¡Œ)
```

**é¢„æœŸæ”¶ç›Š**:
- ç»„ä»¶å¤§å°: 1,188 è¡Œ â†’ æœ€å¤§ 200 è¡Œ
- å¯æµ‹è¯•æ€§: 0% â†’ 80%
- é‡æ¸²æŸ“æˆæœ¬: â†“ 70%
- ä»£ç å¤ç”¨: â†‘ 50%

---

#### 1.2 AIEditing/util.ts (1,102 è¡Œ)

**ä¸¥é‡æ€§**: ğŸ”´ Critical
**é—®é¢˜**: å·¥å…·å‡½æ•°æ–‡ä»¶åŒ…å«å¤ªå¤šé€»è¾‘

**åŠŸèƒ½åˆ†ç±»**:
```typescript
// 1. Quill ç¼–è¾‘å™¨æ“ä½œ (~300 è¡Œ)
export function highlightSelection(...)
export function insertContent(...)
export function renderMarkdownToQuill(...)

// 2. Monaco Diff æ“ä½œ (~250 è¡Œ)
export function showDiffEditor(...)
export function closeDiffEditor(...)
export function initMonaco(...)

// 3. AI å¯¹è¯ç®¡ç† (~200 è¡Œ)
export function handleSend(...)
export function handleRegenerate(...)

// 4. UI èœå•æ§åˆ¶ (~200 è¡Œ)
export function showAIMenu(...)
export function showExportMenu(...)
export function hideAIUI(...)

// 5. å·¥å…·å‡½æ•° (~150 è¡Œ)
export function createTimeAndWordCountDisplay(...)
export function ensureElementsVisible(...)
```

**å»ºè®®æ‹†åˆ†**:
```
components/AIEditing/utils/
â”œâ”€â”€ quillOperations.ts (300 è¡Œ)
â”œâ”€â”€ monacoOperations.ts (250 è¡Œ)
â”œâ”€â”€ aiChatOperations.ts (200 è¡Œ)
â”œâ”€â”€ uiMenuOperations.ts (200 è¡Œ)
â””â”€â”€ helpers.ts (150 è¡Œ)
```

---

### 2. åŒé‡çŠ¶æ€ç®¡ç†ä»æœªå®Œå…¨æ¶ˆé™¤

**ä¸¥é‡æ€§**: ğŸ”´ Critical
**å½“å‰çŠ¶æ€**: ç»„ä»¶å·²è¿ç§»ï¼Œä½† `services/chat.ts` ä»åœ¨ä½¿ç”¨

**é—®é¢˜**:
```typescript
// services/chat.ts (427 è¡Œ) - ä»ç„¶å­˜åœ¨
const chats = ref<Chat[]>([])  // âŒ ä¸ useChatStore é‡å¤
const activeChat = ref<Chat | null>(null)
const messages = ref<Message[]>([])

// 18 ä¸ªæ–‡ä»¶ä»åœ¨ä½¿ç”¨
import { useChats } from '../services/chat.ts'
const { addUserMessage, regenerateResponse, ... } = useChats()
```

**å½±å“**:
- âŒ çŠ¶æ€å¯èƒ½ä¸åŒæ­¥
- âŒ ä»£ç å†—ä½™ï¼ˆPinia Store å’Œ useChats é‡å¤é€»è¾‘ï¼‰
- âŒ æ–°äººå›°æƒ‘ï¼ˆä¸çŸ¥é“ç”¨å“ªä¸ªï¼‰

**è§£å†³æ–¹æ¡ˆ**:
```typescript
// 1. å°† useChats() çš„æ–¹æ³•è¿ç§»åˆ° useChatStore
export const useChatStore = defineStore('chat', () => {
  // ... ç°æœ‰ä»£ç 

  // æ–°å¢æ–¹æ³•ï¼ˆä» useChats è¿ç§»ï¼‰
  async function addUserMessage(content: string, imageUrl?: string) {
    if (!currentChatId.value) return

    const message: Message = {
      chatId: currentChatId.value,
      role: 'user',
      content,
      imageUrl,
      createdAt: new Date(),
    }

    // ... è¿ç§»é€»è¾‘
  }

  // ... å…¶ä»–æ–¹æ³•
})

// 2. åˆ é™¤ services/chat.ts å’Œ services/appConfig.ts
```

**é¢„è®¡å·¥ä½œé‡**: 4-6 å°æ—¶

---

### 3. ç¼ºå°‘ç»Ÿä¸€é”™è¯¯å¤„ç†æœºåˆ¶

**ä¸¥é‡æ€§**: ğŸŸ¡ Important
**ç»Ÿè®¡æ•°æ®**: 83 å¤„ `console.log/warn/error`

**å½“å‰çŠ¶æ€**:
```typescript
// âŒ å„å¤„é”™è¯¯å¤„ç†ä¸ä¸€è‡´
try {
  await api.call()
} catch (err) {
  console.error('å¤±è´¥:', err)  // ä»…æ‰“å°ï¼Œç”¨æˆ·æ— æ„ŸçŸ¥
}

// âŒ æœ‰äº›åœ°æ–¹é™é»˜å¤±è´¥
catch (err) {
  // ä»€ä¹ˆéƒ½ä¸åš
}

// âŒ æœ‰äº›åœ°æ–¹ä»…æ‰“å°è­¦å‘Š
catch (err) {
  console.warn('è­¦å‘Š:', err)
}
```

**å½±å“**:
- ç”¨æˆ·ä½“éªŒå·®ï¼šé”™è¯¯æ—¶æ— æç¤º
- éš¾ä»¥è°ƒè¯•ï¼šç”Ÿäº§ç¯å¢ƒæ— æ³•æ”¶é›†é”™è¯¯
- æ•°æ®ä¸¢å¤±ï¼šé™é»˜å¤±è´¥å¯èƒ½ä¸¢æ•°æ®

**å»ºè®®æ–¹æ¡ˆ**:
```typescript
// core/errors/
â”œâ”€â”€ ErrorBoundary.vue       // Vue é”™è¯¯è¾¹ç•Œ
â”œâ”€â”€ errorHandler.ts         // ç»Ÿä¸€é”™è¯¯å¤„ç†å™¨
â”œâ”€â”€ logger.ts               // æ—¥å¿—ç³»ç»Ÿ
â”œâ”€â”€ toast.ts                // ç”¨æˆ·æç¤º
â””â”€â”€ types.ts                // é”™è¯¯ç±»å‹

// ä½¿ç”¨ç¤ºä¾‹
try {
  await chatStore.addUserMessage(content)
} catch (err) {
  logger.error('æ·»åŠ æ¶ˆæ¯å¤±è´¥', err)
  toast.error(t('errors.addMessageFailed'))
  // å¯é€‰: ä¸ŠæŠ¥åˆ°ç›‘æ§æœåŠ¡
}
```

**é¢„è®¡å·¥ä½œé‡**: 2-3 å°æ—¶

---

## ğŸŸ¡ é‡è¦é—®é¢˜ (Important)

### 4. ESLint é—®é¢˜å¢å¤š

**ç»Ÿè®¡**: 219 ä¸ªé—®é¢˜ï¼ˆ64 é”™è¯¯ + 155 è­¦å‘Šï¼‰

**ä¸»è¦é—®é¢˜ç±»å‹**:

#### 4.1 æœªä½¿ç”¨çš„å˜é‡/å¯¼å…¥ (155 ä¸ªè­¦å‘Š)
```typescript
// âŒ å¯¼å…¥ä½†æœªä½¿ç”¨
import { unused } from 'module'

// âŒ å®šä¹‰ä½†æœªä½¿ç”¨
const props = defineProps()  // è­¦å‘Š
const emit = defineEmits()   // è­¦å‘Š
```

**ä¿®å¤**: å¤§éƒ¨åˆ†å¯è‡ªåŠ¨ä¿®å¤
```bash
pnpm lint:fix  # è‡ªåŠ¨åˆ é™¤
```

#### 4.2 ç±»å‹å®šä¹‰æ–‡ä»¶é—®é¢˜ (64 ä¸ªé”™è¯¯)
```typescript
// html2pdf.d.ts - æ–¹æ³•ç­¾åé£æ ¼
interface Html2Pdf {
  set(options: any): this  // âŒ error: ä½¿ç”¨å‡½æ•°å±æ€§
}

// åº”è¯¥æ”¹ä¸º
interface Html2Pdf {
  set: (options: any) => this  // âœ…
}
```

#### 4.3 any ç±»å‹æ»¥ç”¨ (éƒ¨åˆ†è­¦å‘Š)
```typescript
// âŒ Unexpected any
const data: any = response
function handler(item: any) { }
```

**ä¼˜å…ˆçº§**: P1 - åº”é€æ­¥ä¿®å¤

---

### 5. æ€§èƒ½ä¼˜åŒ–æœºä¼š

**ä¸¥é‡æ€§**: ğŸŸ¡ Important

#### 5.1 å¤§å‹ä¾èµ–æœªæ‡’åŠ è½½

**é—®é¢˜**:
```typescript
// ä¸»å…¥å£ç›´æ¥å¯¼å…¥
import * as monaco from 'monaco-editor'  // 98MB
import Quill from 'quill'  // 3.7MB

// vite.config.ts
build: { chunkSizeWarningLimit: 1500 }  // ä»…æé«˜è­¦å‘Šé˜ˆå€¼ï¼Œæœªè§£å†³é—®é¢˜
```

**å»ºè®®**:
```typescript
// 1. Monaco æ‡’åŠ è½½
const loadMonaco = () => import('monaco-editor')

// ä»…åœ¨ç”¨æˆ·ç‚¹å‡»"å¯¹æ¯”"æŒ‰é’®æ—¶åŠ è½½
async function showDiff() {
  const monaco = await loadMonaco()
  // ...
}

// 2. ä»£ç åˆ†å‰²é…ç½®
// vite.config.ts
export default defineConfig({
  build: {
    rollupOptions: {
      output: {
        manualChunks: {
          'monaco': ['monaco-editor'],
          'quill': ['quill', 'quill-table-ui'],
          'markdown': ['markdown-it', 'katex', 'highlight.js'],
          'naive-ui': ['naive-ui'],
        }
      }
    }
  }
})
```

**é¢„æœŸæ”¶ç›Š**:
- é¦–å±åŠ è½½æ—¶é—´: â†“ 40%
- é¦–æ¬¡åŠ è½½ä½“ç§¯: â†“ 50%

---

#### 5.2 æ— è™šæ‹Ÿæ»šåŠ¨ï¼ˆé•¿æ¶ˆæ¯åˆ—è¡¨ï¼‰

**é—®é¢˜**:
```vue
<!-- ChatMessages.vue -->
<ChatMessage
  v-for="message in visibleMessages"
  :key="message.id"
  :message="message"
/>
<!-- âŒ å¦‚æœæœ‰ 1000 æ¡æ¶ˆæ¯ï¼Œä¼šæ¸²æŸ“ 1000 ä¸ªç»„ä»¶ -->
```

**å»ºè®®**:
```vue
<VirtualScroller
  :items="visibleMessages"
  :item-height="80"
  :buffer="5"
>
  <template #default="{ item }">
    <ChatMessage :message="item" />
  </template>
</VirtualScroller>
```

**é¢„æœŸæ”¶ç›Š**:
- æ¸²æŸ“æ€§èƒ½: â†‘ 80%ï¼ˆé•¿åˆ—è¡¨åœºæ™¯ï¼‰
- å†…å­˜å ç”¨: â†“ 60%

---

#### 5.3 IndexedDB æŸ¥è¯¢æœªä¼˜åŒ–

**é—®é¢˜**:
```typescript
// æ¯æ¬¡éƒ½å…¨é‡æŸ¥è¯¢
await db.messages.where('chatId').equals(chatId).toArray()

// æ²¡æœ‰åˆ†é¡µ
// æ²¡æœ‰ç¼“å­˜
// ç´¢å¼•ä¸å®Œæ•´
```

**å»ºè®®**:
```typescript
// 1. æ·»åŠ å¤åˆç´¢å¼•
db.version(2).stores({
  messages: '++id, chatId, createdAt, [chatId+createdAt]'
})

// 2. åˆ†é¡µæŸ¥è¯¢
async getMessages(chatId: number, page = 0, size = 50) {
  return db.messages
    .where('[chatId+createdAt]')
    .between([chatId, Dexie.minKey], [chatId, Dexie.maxKey])
    .offset(page * size)
    .limit(size)
    .toArray()
}

// 3. æ·»åŠ ç¼“å­˜å±‚
class MessageCache {
  private cache = new Map<number, Message[]>()

  async get(chatId: number) {
    if (this.cache.has(chatId)) {
      return this.cache.get(chatId)
    }
    const messages = await db.getMessages(chatId)
    this.cache.set(chatId, messages)
    return messages
  }
}
```

---

### 6. å›½é™…åŒ–æœªå®Œæ•´å®ç°

**ä¸¥é‡æ€§**: ğŸŸ¡ Important
**å½“å‰çŠ¶æ€**: å·²å®‰è£… `vue-i18n`ï¼Œä½†å¤§é‡ç¡¬ç¼–ç ä¸­æ–‡

**é—®é¢˜ç¤ºä¾‹**:
```typescript
// âŒ ç¡¬ç¼–ç 
const prompts = {
  name: 'ç¿»è¯‘ä¸ºä¸­æ–‡',
  template: 'å°†ä»¥ä¸‹æ–‡æœ¬ç¿»è¯‘ä¸ºä¸­æ–‡...'
}

message.success('ä¿å­˜æˆåŠŸï¼')
console.error('åŠ è½½èŠå¤©åˆ—è¡¨å¤±è´¥:', err)
```

**å»ºè®®**:
```typescript
// âœ… å›½é™…åŒ–
const { t } = useI18n()

const prompts = {
  name: t('prompts.translateToChinese'),
  template: t('prompts.translateTemplate')
}

message.success(t('common.saveSuccess'))
logger.error(t('errors.loadChatsFailed'), err)
```

**é¢„è®¡å·¥ä½œé‡**: 3-4 å°æ—¶

---

## ğŸŸ¢ æ¨èä¼˜åŒ– (Recommended)

### 7. services æ–‡ä»¶å¾…æ¸…ç†

**å½“å‰çŠ¶æ€**:
- `services/chat.ts` - 427 è¡Œï¼Œ18 ä¸ªæ–‡ä»¶åœ¨ç”¨
- `services/appConfig.ts` - 102 è¡Œï¼Œä»åœ¨å¯¼å…¥ä½†å·²è¿ç§»

**é—®é¢˜**:
```typescript
// services/appConfig.ts
export const currentModel = useLocalStorage('currentModel', 'none')
// âš ï¸ å·²è¿ç§»åˆ° stores/app.tsï¼Œä½†æ–‡ä»¶ä»å­˜åœ¨

// services/chat.ts
export function useChats() { ... }
// âš ï¸ ç»„ä»¶ä»åœ¨ä½¿ç”¨ï¼Œéœ€è¦é€æ­¥è¿ç§»
```

**æ¸…ç†ç­–ç•¥**:
```
é˜¶æ®µ 1: è¿ç§» useChats() æ–¹æ³•åˆ° useChatStore âœ… (å·²å®Œæˆ)
é˜¶æ®µ 2: æ›´æ–°ç»„ä»¶ä½¿ç”¨ Store æ–¹æ³•
é˜¶æ®µ 3: åˆ é™¤ services/chat.ts
é˜¶æ®µ 4: åˆ é™¤ services/appConfig.ts
```

---

### 8. ç¼ºå°‘æµ‹è¯•ä½“ç³»

**ä¸¥é‡æ€§**: ğŸŸ¢ Recommended
**å½“å‰çŠ¶æ€**: é›¶æµ‹è¯•æ–‡ä»¶

**å»ºè®®**:
```
tests/
â”œâ”€â”€ unit/
â”‚   â”œâ”€â”€ stores/
â”‚   â”‚   â”œâ”€â”€ app.spec.ts
â”‚   â”‚   â”œâ”€â”€ chat.spec.ts
â”‚   â”‚   â””â”€â”€ config.spec.ts
â”‚   â””â”€â”€ utils/
â”‚       â””â”€â”€ darkMode.spec.ts
â”œâ”€â”€ component/
â”‚   â”œâ”€â”€ ChatInput.spec.ts
â”‚   â”œâ”€â”€ ModelSelector.spec.ts
â”‚   â””â”€â”€ Messages/
â”‚       â”œâ”€â”€ UserMessage.spec.ts
â”‚       â””â”€â”€ AiMessage.spec.ts
â””â”€â”€ e2e/
    â”œâ”€â”€ chat.spec.ts
    â””â”€â”€ ai-editing.spec.ts
```

**å·¥å…·æ ˆ**:
- Vitestï¼ˆå•å…ƒæµ‹è¯•ï¼‰
- Vue Test Utilsï¼ˆç»„ä»¶æµ‹è¯•ï¼‰
- Playwrightï¼ˆE2E æµ‹è¯• - å·²æœ‰ MCP å·¥å…·ï¼‰

**ä¼˜å…ˆæµ‹è¯•**:
1. useChatStoreï¼ˆæ ¸å¿ƒä¸šåŠ¡é€»è¾‘ï¼‰
2. useAppStoreï¼ˆå…¨å±€é…ç½®ï¼‰
3. ChatInputï¼ˆç”¨æˆ·è¾“å…¥ï¼‰
4. å¯¼å…¥å¯¼å‡ºåŠŸèƒ½

**ç›®æ ‡è¦†ç›–ç‡**: 60%

---

### 9. ä»£ç ç»„ç»‡ç»“æ„å¯ä¼˜åŒ–

**å½“å‰ç»“æ„**:
```
src/
â”œâ”€â”€ components/       # æ··æ‚ç»„ä»¶
â”‚   â”œâ”€â”€ AIEditing/   # ç‹¬ç«‹ä¸šåŠ¡ï¼ˆåº”æå‡ï¼‰
â”‚   â”œâ”€â”€ Messages/    # èŠå¤©æ¶ˆæ¯
â”‚   â”œâ”€â”€ Inputs/      # è¡¨å•ç»„ä»¶
â”‚   â””â”€â”€ History/     # å†å²è®°å½•
â”œâ”€â”€ services/        # æ—§æ¶æ„ï¼ˆå¾…åˆ é™¤ï¼‰
â”œâ”€â”€ stores/          # Pinia Store
â”œâ”€â”€ api/             # API å±‚
â””â”€â”€ utils/           # å·¥å…·å‡½æ•°
```

**å»ºè®®ç»“æ„**ï¼ˆåŠŸèƒ½æ¨¡å—åŒ–ï¼‰:
```
src/
â”œâ”€â”€ features/           # æŒ‰åŠŸèƒ½ç»„ç»‡
â”‚   â”œâ”€â”€ chat/
â”‚   â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”‚   â”œâ”€â”€ ChatInput.vue
â”‚   â”‚   â”‚   â”œâ”€â”€ ChatMessages.vue
â”‚   â”‚   â”‚   â””â”€â”€ ChatMessage.vue
â”‚   â”‚   â”œâ”€â”€ stores/
â”‚   â”‚   â”‚   â””â”€â”€ chat.ts
â”‚   â”‚   â””â”€â”€ api/
â”‚   â”‚       â””â”€â”€ chat.ts
â”‚   â””â”€â”€ ai-editing/
â”‚       â”œâ”€â”€ components/
â”‚       â”‚   â”œâ”€â”€ editor/
â”‚       â”‚   â”œâ”€â”€ prompts/
â”‚       â”‚   â””â”€â”€ dialogs/
â”‚       â”œâ”€â”€ composables/
â”‚       â”œâ”€â”€ stores/
â”‚       â””â”€â”€ utils/
â”œâ”€â”€ shared/             # å…±äº«èµ„æº
â”‚   â”œâ”€â”€ components/     # é€šç”¨ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ Inputs/
â”‚   â”‚   â””â”€â”€ UI/
â”‚   â”œâ”€â”€ composables/
â”‚   â”œâ”€â”€ utils/
â”‚   â””â”€â”€ types/
â”œâ”€â”€ core/               # æ ¸å¿ƒåŠŸèƒ½
â”‚   â”œâ”€â”€ database/
â”‚   â”œâ”€â”€ api/
â”‚   â”œâ”€â”€ config/
â”‚   â””â”€â”€ errors/         # æ–°å¢
â””â”€â”€ App.vue
```

**ä¼˜åŠ¿**:
- åŠŸèƒ½æ¨¡å—æ¸…æ™°ç‹¬ç«‹
- æ˜“äºä»£ç å¯¼èˆª
- ä¾¿äºå›¢é˜Ÿåä½œ
- æ”¯æŒæŒ‰åŠŸèƒ½æ‡’åŠ è½½

---

### 10. API é”™è¯¯å¤„ç†ä¸å®Œå–„

**é—®é¢˜**:
```typescript
// api/api.ts
catch (err) {
  console.error('ç”ŸæˆèŠå¤©å†…å®¹æ—¶å‡ºé”™:', err)
  error.value = toError(err)
  return []  // âŒ é™é»˜å¤±è´¥
}
```

**å»ºè®®**:
```typescript
// 1. å®šä¹‰é”™è¯¯ç±»å‹
export class APIError extends Error {
  code: string
  status: number
  retryable: boolean
}

// 2. ç»Ÿä¸€é”™è¯¯å¤„ç†
catch (err) {
  const apiError = new APIError(err)
  logger.error('API call failed', apiError)

  if (apiError.retryable) {
    return retry(operation)
  }

  toast.error(t('errors.apiCallFailed'))
  throw apiError
}
```

---

## ğŸ“Š ä¼˜åŒ–æœºä¼šçŸ©é˜µ

### ä¼˜å…ˆçº§æ’åº

| ä»»åŠ¡ | ä¸¥é‡æ€§ | å½±å“èŒƒå›´ | å·¥ä½œé‡ | ROI | ä¼˜å…ˆçº§ |
|------|--------|----------|--------|-----|--------|
| æ‹†åˆ† AIEditing å·¨å‹ç»„ä»¶ | ğŸ”´ | é«˜ | 8-10h | â­â­â­â­â­ | **P0** |
| å®Œæˆ useChats è¿ç§» | ğŸ”´ | ä¸­ | 4-6h | â­â­â­â­ | **P0** |
| åˆ›å»ºé”™è¯¯å¤„ç†ç³»ç»Ÿ | ğŸŸ¡ | é«˜ | 2-3h | â­â­â­â­ | **P1** |
| æ‡’åŠ è½½å¤§å‹ä¾èµ– | ğŸŸ¡ | ä¸­ | 2-3h | â­â­â­â­ | **P1** |
| æ¸…ç† ESLint é—®é¢˜ | ğŸŸ¡ | ä½ | 1-2h | â­â­â­ | P1 |
| å®Œå–„å›½é™…åŒ– | ğŸŸ¡ | ä¸­ | 3-4h | â­â­â­ | P2 |
| é‡ç»„é¡¹ç›®ç»“æ„ | ğŸŸ¢ | é«˜ | 6-8h | â­â­â­ | P2 |
| å»ºç«‹æµ‹è¯•ä½“ç³» | ğŸŸ¢ | é«˜ | 8-10h | â­â­â­â­ | P2 |
| IndexedDB ä¼˜åŒ– | ğŸŸ¢ | ä½ | 2-3h | â­â­ | P3 |
| æ·»åŠ è™šæ‹Ÿæ»šåŠ¨ | ğŸŸ¢ | ä½ | 1-2h | â­â­ | P3 |

**ROI**: Return on Investmentï¼ˆæŠ•èµ„å›æŠ¥ç‡ï¼‰

---

## ğŸ¯ æ¨èè¡ŒåŠ¨è®¡åˆ’

### ç¬¬ä¸€ä¼˜å…ˆçº§ï¼ˆä¸‹ä¸€æ­¥ç«‹å³åšï¼‰

#### ä»»åŠ¡ 1: æ‹†åˆ† AIEditing å·¨å‹ç»„ä»¶ (P0, 8-10h)

**åŸå› **:
- æœ€å¤§çš„æŠ€æœ¯å€ºåŠ¡
- å½±å“ç»´æŠ¤æ€§å’Œæ€§èƒ½
- é˜»ç¢åç»­ä¼˜åŒ–

**æ­¥éª¤**:
1. åˆ›å»ºç»„ä»¶ç»“æ„
2. æå– composables
3. æ‹†åˆ†å­ç»„ä»¶
4. æµ‹è¯•éªŒè¯
5. åˆ é™¤æ—§ç»„ä»¶

**é¢„æœŸæ”¶ç›Š**: â­â­â­â­â­

---

#### ä»»åŠ¡ 2: å®Œæˆ useChats() è¿ç§» (P0, 4-6h)

**åŸå› **:
- å®ŒæˆçŠ¶æ€ç®¡ç†ç»Ÿä¸€
- æ¶ˆé™¤åŒé‡æ¶æ„
- é™ä½ç»´æŠ¤æˆæœ¬

**æ­¥éª¤**:
1. è¿ç§»ä¸šåŠ¡æ–¹æ³•åˆ° useChatStore
2. æ›´æ–°ç»„ä»¶å¼•ç”¨
3. åˆ é™¤ services/chat.ts
4. åˆ é™¤ services/appConfig.ts
5. éªŒè¯åŠŸèƒ½

**é¢„æœŸæ”¶ç›Š**: â­â­â­â­

---

### ç¬¬äºŒä¼˜å…ˆçº§ï¼ˆæœ¬å‘¨å†…å®Œæˆï¼‰

#### ä»»åŠ¡ 3: åˆ›å»ºç»Ÿä¸€é”™è¯¯å¤„ç† (P1, 2-3h)

**æ­¥éª¤**:
1. åˆ›å»º core/errors/ ç›®å½•
2. å®ç° ErrorBoundary ç»„ä»¶
3. åˆ›å»º logger å’Œ toast
4. æ›´æ–°æ‰€æœ‰ catch å—

---

#### ä»»åŠ¡ 4: æ€§èƒ½ä¼˜åŒ– - æ‡’åŠ è½½ (P1, 2-3h)

**æ­¥éª¤**:
1. Monaco ç¼–è¾‘å™¨æ‡’åŠ è½½
2. Quill æŒ‰éœ€åŠ è½½
3. Vite ä»£ç åˆ†å‰²é…ç½®
4. éªŒè¯åŠ è½½æ€§èƒ½

---

### ç¬¬ä¸‰ä¼˜å…ˆçº§ï¼ˆæœ¬æœˆå®Œæˆï¼‰

#### ä»»åŠ¡ 5: ä»£ç è´¨é‡æå‡
- æ¸…ç† ESLint é—®é¢˜
- å®Œå–„å›½é™…åŒ–
- æ·»åŠ å•å…ƒæµ‹è¯•

---

## ğŸ“ˆ é¢„æœŸæ”¶ç›Š

### çŸ­æœŸæ”¶ç›Šï¼ˆå®Œæˆ P0 ä»»åŠ¡ï¼‰

**å¼€å‘æ•ˆç‡**:
- å®šä½é—®é¢˜æ—¶é—´: â†“ 70%
- æ–°åŠŸèƒ½å¼€å‘é€Ÿåº¦: â†‘ 50%
- Bug ä¿®å¤æ—¶é—´: â†“ 60%

**ä»£ç è´¨é‡**:
- å¯ç»´æŠ¤æ€§: â†‘ 80%
- å¯æµ‹è¯•æ€§: 0% â†’ 60%
- ä»£ç å¤ç”¨: â†‘ 50%

### ä¸­æœŸæ”¶ç›Šï¼ˆå®Œæˆ P1 ä»»åŠ¡ï¼‰

**ç”¨æˆ·ä½“éªŒ**:
- é¦–å±åŠ è½½æ—¶é—´: â†“ 40%
- é”™è¯¯æç¤ºå‹å¥½åº¦: â†‘ 100%
- é•¿åˆ—è¡¨æ»šåŠ¨æµç•…åº¦: â†‘ 80%

**æŠ€æœ¯å€ºåŠ¡**:
- æŠ€æœ¯å€ºåŠ¡å‡å°‘: 70%
- æ¶æ„æ¸…æ™°åº¦: â†‘ 60%

### é•¿æœŸæ”¶ç›Šï¼ˆå®Œæˆ P2 ä»»åŠ¡ï¼‰

**å›¢é˜Ÿåä½œ**:
- æ–°äººä¸Šæ‰‹æ—¶é—´: â†“ 50%
- ä»£ç å®¡æŸ¥æ•ˆç‡: â†‘ 40%
- é‡æ„é£é™©: â†“ 70%

---

## ğŸ” æ·±åº¦é—®é¢˜åˆ†æ

### æ•°æ®æµå¤æ‚åº¦

**å½“å‰æ•°æ®æµ**:
```
User Input â†’ ChatInput.vue
  â†’ useChats() [services/chat.ts]
    â†’ useChatStore [stores/chat.ts]
      â†’ Database [dexie]
```

**é—®é¢˜**: ä¸‰å±‚æŠ½è±¡ï¼ˆuseChats â†’ Store â†’ DBï¼‰

**å»ºè®®**: ç®€åŒ–ä¸ºä¸¤å±‚
```
User Input â†’ Component
  â†’ useChatStore [åŒ…å«æ‰€æœ‰ä¸šåŠ¡é€»è¾‘]
    â†’ Database [dexie]
```

---

### ç±»å‹å®‰å…¨ç°çŠ¶

**å·²è§£å†³**:
- âœ… TypeScript ç¼–è¯‘é›¶é”™è¯¯
- âœ… ç¬¬ä¸‰æ–¹åº“ç±»å‹å®Œæ•´
- âœ… API å“åº”ç±»å‹ç»Ÿä¸€

**æœªè§£å†³**:
- âš ï¸ 15 ä¸ªæ–‡ä»¶ä»æœ‰ `any` ç±»å‹
- âš ï¸ éƒ¨åˆ†å‡½æ•°å‚æ•°ç¼ºå°‘ç±»å‹
- âš ï¸ Event å¯¹è±¡ç±»å‹ä¸å¤Ÿç²¾ç¡®

---

### ä¾èµ–å…³ç³»åˆ†æ

**å¾ªç¯ä¾èµ–é£é™©**: ä½ï¼ˆç›®å‰æ— æ˜æ˜¾å¾ªç¯ï¼‰

**ç´§è€¦åˆé—®é¢˜**:
```typescript
// AIEditing/util.ts â†’ api.ts
// AIEditing/index.vue â†’ util.ts
// AIEditing/index.vue â†’ api.ts
// âš ï¸ AIEditing æ¨¡å—å†…éƒ¨è€¦åˆåº¦é«˜
```

---

## ğŸ› ï¸ æŠ€æœ¯æ ˆä¼˜åŒ–å»ºè®®

### å¯è€ƒè™‘æ›¿æ¢çš„åº“

1. **Naive UI â†’ Radix Vue + Tailwind**
   - æ›´è½»é‡ï¼ˆNaive UI è¾ƒé‡ï¼‰
   - æ›´å¥½çš„ Headless æ¨¡å¼
   - æ›´çµæ´»çš„æ ·å¼æ§åˆ¶

2. **Quill â†’ Lexical / TipTap**
   - æ›´ç°ä»£çš„æ¶æ„
   - æ›´å¥½çš„ TypeScript æ”¯æŒ
   - æ›´æ´»è·ƒçš„ç¤¾åŒº

3. **Dexie â†’ TanStack Query + localStorage**
   - ç®€åŒ–æ•°æ®å±‚
   - æ›´å¥½çš„ç¼“å­˜æ§åˆ¶
   - å‡å°‘ä¾èµ–

**æ³¨æ„**: è¿™äº›æ˜¯é•¿æœŸè€ƒè™‘ï¼Œä¸å»ºè®®ç«‹å³æ›¿æ¢

---

## ğŸ“‹ ä¸‹ä¸€æ­¥è¡ŒåŠ¨å»ºè®®

### ç«‹å³è¡ŒåŠ¨ï¼ˆä»Šå¤©ï¼‰

1. **æ¸…ç† ESLint è­¦å‘Š**
```bash
pnpm lint:fix  # è‡ªåŠ¨ä¿®å¤
# æ‰‹åŠ¨ä¿®å¤å‰©ä½™é—®é¢˜
```

2. **ä¿®å¤ html2pdf.d.ts ç±»å‹å®šä¹‰**
```typescript
// æ”¹ä¸ºå‡½æ•°å±æ€§é£æ ¼
interface Html2Pdf {
  set: (options: any) => this
  from: (element: HTMLElement) => this
  save: () => Promise<void>
}
```

### æœ¬å‘¨è®¡åˆ’

3. **æ‹†åˆ† AIEditing/util.ts**ï¼ˆå…ˆäº index.vueï¼‰
   - åˆ›å»º 5 ä¸ªä¸“é—¨çš„å·¥å…·æ–‡ä»¶
   - å‡å°‘æ–‡ä»¶å¤§å°åˆ° < 300 è¡Œ

4. **å®Œæˆ useChats() è¿ç§»**
   - è¿ç§» 9 ä¸ªæ–¹æ³•åˆ° useChatStore
   - åˆ é™¤ services æ–‡ä»¶

### æœ¬æœˆè®¡åˆ’

5. **åˆ›å»ºé”™è¯¯å¤„ç†ç³»ç»Ÿ**
6. **æ€§èƒ½ä¼˜åŒ–ï¼ˆæ‡’åŠ è½½ï¼‰**
7. **æ·»åŠ å•å…ƒæµ‹è¯•ï¼ˆæ ¸å¿ƒ Storeï¼‰**

---

## ğŸ“ æ¶æ„æœ€ä½³å®è·µå¯¹ç…§

### ç›®å‰ç¬¦åˆçš„æœ€ä½³å®è·µ âœ…

- âœ… **å•ä¸€æ•°æ®æº**: Pinia Store ä½œä¸ºå”¯ä¸€çŠ¶æ€æº
- âœ… **ç±»å‹å®‰å…¨**: TypeScript ä¸¥æ ¼æ¨¡å¼
- âœ… **ç»„ä»¶åŒ–**: Vue 3 Composition API
- âœ… **å“åº”å¼**: æ­£ç¡®ä½¿ç”¨ storeToRefs

### è¿åçš„æœ€ä½³å®è·µ âŒ

- âŒ **å•ä¸€èŒè´£åŸåˆ™**: AIEditing/index.vue 1,188 è¡Œ
- âŒ **DRY åŸåˆ™**: useChats å’Œ Store é‡å¤é€»è¾‘
- âŒ **å…³æ³¨ç‚¹åˆ†ç¦»**: util.ts åŒ…å« 5 ç§ä¸åŒåŠŸèƒ½
- âŒ **é”™è¯¯å¤„ç†**: ç¼ºå°‘ç»Ÿä¸€æœºåˆ¶

---

## ğŸ’° æŠ•èµ„å›æŠ¥è¯„ä¼°

### é«˜å›æŠ¥ä»»åŠ¡ï¼ˆå»ºè®®ä¼˜å…ˆï¼‰

1. **æ‹†åˆ†å·¨å‹ç»„ä»¶** - ROI: 5/5
   - æˆæœ¬: 8-10 å°æ—¶
   - æ”¶ç›Š: ç»´æŠ¤æ€§â†‘80%, æ€§èƒ½â†‘50%, å¯æµ‹è¯•æ€§â†‘100%

2. **ç»Ÿä¸€é”™è¯¯å¤„ç†** - ROI: 4/5
   - æˆæœ¬: 2-3 å°æ—¶
   - æ”¶ç›Š: ç”¨æˆ·ä½“éªŒâ†‘100%, å¯è°ƒè¯•æ€§â†‘80%

3. **å®Œæˆ useChats è¿ç§»** - ROI: 4/5
   - æˆæœ¬: 4-6 å°æ—¶
   - æ”¶ç›Š: æ¶æ„æ¸…æ™°â†‘100%, ç»´æŠ¤æˆæœ¬â†“50%

### ä¸­å›æŠ¥ä»»åŠ¡

4. **æ€§èƒ½ä¼˜åŒ–** - ROI: 3/5
   - æˆæœ¬: 2-3 å°æ—¶
   - æ”¶ç›Š: åŠ è½½é€Ÿåº¦â†‘40%

5. **å»ºç«‹æµ‹è¯•** - ROI: 4/5ï¼ˆé•¿æœŸï¼‰
   - æˆæœ¬: 8-10 å°æ—¶
   - æ”¶ç›Š: Bug å‡å°‘â†“70%, é‡æ„ä¿¡å¿ƒâ†‘100%

---

## ğŸ æ€»ç»“

### å½“å‰é¡¹ç›®çŠ¶æ€: è‰¯å¥½ï¼ˆ75/100ï¼‰

**å·²å®Œæˆ**: TypeScript ç±»å‹ç³»ç»Ÿ âœ…ã€Pinia è¿ç§» âœ…

**æœ€å¤§é—®é¢˜**:
1. å·¨å‹ç»„ä»¶ï¼ˆAIEditing æ¨¡å—ï¼‰
2. åŒé‡çŠ¶æ€ç®¡ç†æœªå®Œå…¨æ¸…ç†
3. ç¼ºå°‘é”™è¯¯å¤„ç†æœºåˆ¶

**å»ºè®®ä¼˜å…ˆçº§**:
- **P0**: æ‹†åˆ† AIEditing + å®Œæˆ useChats è¿ç§»
- **P1**: é”™è¯¯å¤„ç† + æ€§èƒ½ä¼˜åŒ–
- **P2**: æµ‹è¯•ä½“ç³» + é¡¹ç›®é‡ç»„

**é¢„è®¡æ€»å·¥ä½œé‡**: 20-30 å°æ—¶ï¼ˆå®Œæˆæ‰€æœ‰ P0 å’Œ P1 ä»»åŠ¡ï¼‰

**æœ€ç»ˆç›®æ ‡**: é¡¹ç›®å¥åº·åº¦è¾¾åˆ° 90/100

---

**æŠ¥å‘Šç”Ÿæˆæ—¶é—´**: 2025-10-01
**åˆ†æå·¥å…·**: Claude Code Architecture Analyzer
**ä¸‹æ¬¡è¯„å®¡**: å®Œæˆ P0 ä»»åŠ¡å
