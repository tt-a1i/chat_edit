# å‰ç«¯æ¶æ„é‡æ„åˆ†æä¸ä¼˜åŒ–å»ºè®®

## ğŸ“Š é¡¹ç›®æ¦‚å†µ

**é¡¹ç›®è§„æ¨¡ç»Ÿè®¡**:
- æ€»ä»£ç è¡Œæ•°: 6,946 è¡Œ (ä¸å«ç©ºè¡Œå’Œæ³¨é‡Š)
- TypeScript: 3,169 è¡Œ (26 ä¸ªæ–‡ä»¶)
- Vueç»„ä»¶: 2,450 è¡Œ (25 ä¸ªæ–‡ä»¶)
- LESS/CSS: 1,327 è¡Œ (3 ä¸ªæ–‡ä»¶)
- æœ€å¤§å•æ–‡ä»¶: `AIEditing/index.vue` (1,188 è¡Œ) âš ï¸

**æŠ€æœ¯æ ˆ**:
- Vue 3.3.4 + TypeScript 5.6.3
- Pinia 3.0.3 (çŠ¶æ€ç®¡ç†)
- Vite 5.0.10 (æ„å»ºå·¥å…·)
- Dexie 3.2.4 (IndexedDBå°è£…)
- Quill 2.0.3 (å¯Œæ–‡æœ¬ç¼–è¾‘å™¨)
- Monaco Editor (ä»£ç ç¼–è¾‘å™¨)

---

## ğŸ”´ ä¸¥é‡é—®é¢˜ (Critical Issues)

### 1. TypeScript ç±»å‹ç³»ç»Ÿä¸¥é‡ç¼ºé™·

**é—®é¢˜ä¸¥é‡æ€§**: ğŸ”´ Critical
**å½±å“èŒƒå›´**: å…¨å±€
**å½“å‰çŠ¶æ€**: é¡¹ç›®æ— æ³•é€šè¿‡ `vue-tsc --noEmit` ç±»å‹æ£€æŸ¥ï¼Œå­˜åœ¨ **100+ ä¸ªç±»å‹é”™è¯¯**

**ä¸»è¦ç±»å‹é”™è¯¯**:
```typescript
// AIEditing/util.ts - å¤§é‡ any ç±»å‹å’Œ null æ£€æŸ¥ç¼ºå¤±
export function handleSend(data: any) { ... }  // âŒ æœªå®šä¹‰ç±»å‹
const element = document.querySelector('.editor')  // âŒ å¯èƒ½ä¸º null

// AIEditing/api.ts - ç¼ºå°‘ç±»å‹å®šä¹‰
Property '$message' does not exist on type 'Window'  // âŒ å…¨å±€å¯¹è±¡æ±¡æŸ“
Cannot find name 'HttpError'  // âŒ ç¼ºå°‘é”™è¯¯ç±»å‹
Property 'done' does not exist on type 'ChatResponse'  // âŒ ç±»å‹ä¸åŒ¹é…

// AIEditing/export.ts - éšå¼ any
Parameter 'child' implicitly has an 'any' type  // âŒ 72 å¤„éšå¼ any
```

**å½±å“**:
- âŒ ä»£ç æ™ºèƒ½æç¤ºç¼ºå¤±
- âŒ è¿è¡Œæ—¶é”™è¯¯é£é™©æé«˜
- âŒ é‡æ„å›°éš¾ï¼Œå®¹æ˜“å¼•å…¥ bug
- âŒ æ–°äººä¸Šæ‰‹å›°éš¾

**ä¼˜å…ˆçº§**: P0 - å¿…é¡»ç«‹å³ä¿®å¤

---

### 2. çŠ¶æ€ç®¡ç†åŒé‡æ¶æ„æ··ä¹±

**é—®é¢˜ä¸¥é‡æ€§**: ğŸ”´ Critical
**å½±å“èŒƒå›´**: å…¨å±€æ¶æ„

**å½“å‰çŠ¶æ€**: é¡¹ç›®åŒæ—¶ä½¿ç”¨ä¸¤å¥—çŠ¶æ€ç®¡ç†ç³»ç»Ÿ

#### æ–¹æ¡ˆ A: Pinia Store (æ–°æ¶æ„ - éƒ¨åˆ†å®ç°)
```typescript
// src/stores/app.ts - Pinia Store
export const useAppStore = defineStore('app', () => {
  const currentScene = ref<SceneType>(SCENES.CHAT)
  const currentModel = useLocalStorage('currentModel', 'moonshot-v1-8k')
  // ... 90+ è¡Œå®Œæ•´å®ç°
})

// src/stores/chat.ts - Pinia Store
export const useChatStore = defineStore('chat', () => {
  const chats = ref<Chat[]>([])
  const messages = ref<Message[]>([])
  // ... 178 è¡Œå®Œæ•´å®ç°
})
```

#### æ–¹æ¡ˆ B: Composables (æ—§æ¶æ„ - ä»åœ¨ä½¿ç”¨)
```typescript
// src/services/appConfig.ts - Composable å¯¼å‡º
export const currentScene = ref(SCENES.CHAT)
export const currentModel = useLocalStorage('currentModel', 'none')
export const isDarkMode = useLocalStorage('darkMode', true)
// ... ç›´æ¥å¯¼å‡º refï¼Œ65 è¡Œ

// src/services/chat.ts - Composable å‡½æ•°
export function useChats() {
  const chats = ref<Chat[]>([])
  const messages = ref<Message[]>([])
  // ... 428 è¡Œå¤æ‚é€»è¾‘
}
```

#### ä½¿ç”¨æƒ…å†µç»Ÿè®¡
```bash
ä½¿ç”¨ services/ (æ—§æ¶æ„): 19 ä¸ªæ–‡ä»¶
ä½¿ç”¨ stores/ (æ–°æ¶æ„):   3 ä¸ªæ–‡ä»¶
```

**æ¶æ„å†²çª**:
```typescript
// âŒ ä¸¤å¥—ç³»ç»Ÿå®šä¹‰ç›¸åŒçŠ¶æ€ï¼Œå¯¼è‡´æ•°æ®ä¸ä¸€è‡´
// services/appConfig.ts
export const currentScene = ref(SCENES.CHAT)

// stores/app.ts
export const useAppStore = defineStore('app', () => {
  const currentScene = ref<SceneType>(SCENES.CHAT)
})
```

**å½±å“**:
- âŒ çŠ¶æ€åŒæ­¥é—®é¢˜ï¼šä¿®æ”¹ä¸€å¤„çŠ¶æ€ï¼Œå¦ä¸€å¤„ä¸æ›´æ–°
- âŒ éš¾ä»¥è¿½è¸ªæ•°æ®æµå‘
- âŒ å¼€å‘è€…æ··æ·†ï¼šä¸çŸ¥é“ä½¿ç”¨å“ªå¥—ç³»ç»Ÿ
- âŒ ä»£ç å†—ä½™ï¼šç›¸åŒé€»è¾‘é‡å¤å®ç°

**ä¼˜å…ˆçº§**: P0 - å¿…é¡»ç»Ÿä¸€æ¶æ„

---

### 3. å·¨å‹ç»„ä»¶åæ¨¡å¼

**é—®é¢˜ä¸¥é‡æ€§**: ğŸ”´ Critical
**è¿ååŸåˆ™**: Single Responsibility Principle (SRP)

**é—®é¢˜æ–‡ä»¶**: `src/components/AIEditing/index.vue` (1,188 è¡Œ)

**ä»£ç ç»“æ„åˆ†æ**:
```vue
<script setup>
// 47 è¡Œå…¨å±€å˜é‡å£°æ˜ï¼ˆlet è€Œé ref/reactiveï¼‰
let quill = null
let toolbar = null
let diffEditor = null
let currentRange = null
// ... 43 more variables

// 68 è¡Œ Prompts é…ç½®æ•°æ®
const promptsData = ref({
  system: [...],  // 19 ä¸ªé¢„å®šä¹‰ prompt
  custom: [],
  customChats: []
})

// 900+ è¡Œæ··æ‚é€»è¾‘:
// - Quill ç¼–è¾‘å™¨åˆå§‹åŒ– (150 è¡Œ)
// - Monaco ç¼–è¾‘å™¨é…ç½® (200 è¡Œ)
// - AI å¯¹è¯æµç¨‹ (300 è¡Œ)
// - å¯¼å…¥å¯¼å‡ºåŠŸèƒ½ (150 è¡Œ)
// - UI äº¤äº’é€»è¾‘ (200 è¡Œ)
// - äº‹ä»¶å¤„ç† (100 è¡Œ)
</script>

<template>
  <!-- 200+ è¡Œå¤æ‚åµŒå¥—ç»“æ„ -->
</template>

<style>
  /* 200+ è¡Œæ ·å¼ */
</style>
```

**å…·ä½“é—®é¢˜**:

1. **å…¨å±€çŠ¶æ€æ³„æ¼**:
```javascript
// âŒ ä½¿ç”¨ let è€Œé Vue å“åº”å¼
const quill = null // åº”è¯¥æ˜¯ ref<Quill | null>
const toolbar = null // åº”è¯¥æ˜¯ ref<HTMLElement | null>
const currentRange = null // åº”è¯¥æ˜¯ ref<Range | null>
```

2. **åŠŸèƒ½è€¦åˆä¸¥é‡**:
```typescript
// âŒ ä¸€ä¸ªæ–‡ä»¶åŒ…å« 5+ ä¸ªä¸åŒèŒè´£
- å¯Œæ–‡æœ¬ç¼–è¾‘å™¨é€»è¾‘ (Quill)
- ä»£ç  Diff æ˜¾ç¤º (Monaco)
- AI å¯¹è¯ç®¡ç†
- æ–‡ä»¶å¯¼å…¥å¯¼å‡º
- UI èœå•æ§åˆ¶
```

3. **éš¾ä»¥æµ‹è¯•å’Œç»´æŠ¤**:
- æ— æ³•å•ç‹¬æµ‹è¯•æŸä¸ªåŠŸèƒ½
- ä¿®æ”¹ä¸€å¤„å¯èƒ½å½±å“å¤šä¸ªåŠŸèƒ½
- ä»£ç å¤ç”¨å›°éš¾

**å½±å“**:
- âŒ æ€§èƒ½é—®é¢˜ï¼šæ•´ä¸ªç»„ä»¶é‡æ¸²æŸ“æˆæœ¬é«˜
- âŒ ç»´æŠ¤å›°éš¾ï¼šä¿®æ”¹ä¸€å¤„å½±å“å…¨å±€
- âŒ Bug é£é™©ï¼šå˜é‡ä½œç”¨åŸŸç®¡ç†æ··ä¹±
- âŒ å¼€å‘æ•ˆç‡ä½ï¼šå®šä½é—®é¢˜å›°éš¾

**ä¼˜å…ˆçº§**: P0 - å¿…é¡»æ‹†åˆ†

---

## ğŸŸ¡ é‡è¦é—®é¢˜ (Important Issues)

### 4. é”™è¯¯å¤„ç†æœºåˆ¶ç¼ºå¤±

**é—®é¢˜ä¸¥é‡æ€§**: ğŸŸ¡ Important
**å½±å“èŒƒå›´**: å…¨å±€

**å½“å‰çŠ¶æ€**: 85 å¤„ `console.log/error/warn`ï¼Œç¼ºå°‘ç»Ÿä¸€é”™è¯¯å¤„ç†

**é—®é¢˜ç¤ºä¾‹**:
```typescript
// âŒ services/chat.ts - ä»…æ‰“å°é”™è¯¯ï¼Œç”¨æˆ·æ— æ„ŸçŸ¥
async function loadChats() {
  try {
    chats.value = await db.chats.toArray()
  } catch (err) {
    console.error('åŠ è½½èŠå¤©åˆ—è¡¨å¤±è´¥:', err)  // âŒ ä»…æ‰“å°
    // ç¼ºå°‘: ç”¨æˆ·æç¤ºã€é”™è¯¯ä¸ŠæŠ¥ã€é™çº§å¤„ç†
  }
}

// âŒ api/api.ts - é”™è¯¯ä¿¡æ¯ä¸¢å¤±
catch (err) {
  console.error('ç”ŸæˆèŠå¤©å†…å®¹æ—¶å‡ºé”™:', err)
  return []  // âŒ é™é»˜å¤±è´¥ï¼Œç”¨æˆ·ä¸çŸ¥é“å‘ç”Ÿäº†ä»€ä¹ˆ
}

// âŒ AIEditing/util.ts - é”™è¯¯å¤„ç†ä¸ä¸€è‡´
if (!responseContent) {
  console.error('responseContent is null')  // æœ‰æ—¶æ‰“å°
  return  // æœ‰æ—¶ç›´æ¥è¿”å›
}
```

**ç¼ºå¤±çš„é”™è¯¯å¤„ç†æœºåˆ¶**:
1. âŒ å…¨å±€é”™è¯¯è¾¹ç•Œ (Error Boundary)
2. âŒ ç»Ÿä¸€é”™è¯¯æç¤ºç»„ä»¶
3. âŒ é”™è¯¯æ—¥å¿—æ”¶é›†
4. âŒ ç½‘ç»œé”™è¯¯é‡è¯•æœºåˆ¶
5. âŒ é™çº§æ–¹æ¡ˆ (Fallback)

**å½±å“**:
- ç”¨æˆ·ä½“éªŒå·®ï¼šé”™è¯¯å‘ç”Ÿæ—¶æ— æç¤º
- éš¾ä»¥å®šä½é—®é¢˜ï¼šç”Ÿäº§ç¯å¢ƒæ— æ—¥å¿—
- æ•°æ®ä¸¢å¤±é£é™©ï¼šé™é»˜å¤±è´¥

**ä¼˜å…ˆçº§**: P1 - åº”å°½å¿«å»ºç«‹

---

### 5. ESLint è´¨é‡é—®é¢˜

**é—®é¢˜ä¸¥é‡æ€§**: ğŸŸ¡ Important

**ç»Ÿè®¡æ•°æ®**:
- æ€»é—®é¢˜æ•°: 79 ä¸ª
- é”™è¯¯: 38 ä¸ª
- è­¦å‘Š: 41 ä¸ª

**ä¸»è¦é—®é¢˜ç±»å‹**:
```typescript
// 1. æœªä½¿ç”¨çš„å˜é‡/å¯¼å…¥
import { unused } from 'node:module' // âŒ 41 å¤„

// 2. æœªä½¿ç”¨çš„å‚æ•°
function handler(event, context) { // âŒ ä»…ç”¨äº† event
  // æœªä½¿ç”¨ context
}

// 3. any ç±»å‹æ»¥ç”¨
const data: any = response // âŒ 38 å¤„
```

**ä¼˜å…ˆçº§**: P1 - åº”é€æ­¥ä¿®å¤

---

### 6. æ•°æ®åº“å±‚è®¾è®¡é—®é¢˜

**é—®é¢˜ä¸¥é‡æ€§**: ğŸŸ¡ Important

**å½“å‰æ¶æ„**:
```typescript
// services/chat.ts - å†…åµŒçš„ dbLayer
const dbLayer = {
  async getAllChats() {
    return db.chats.toArray()
  },
  async getChat(chatId) {
    return db.chats.get(chatId)
  },
  // ... 15 ä¸ªæ–¹æ³•ç›´æ¥æ“ä½œ Dexie
}

export function useChats() {
  // ... ç›´æ¥è°ƒç”¨ dbLayer
  const chats = await dbLayer.getAllChats()
}
```

**é—®é¢˜**:
1. âŒ èŒè´£è€¦åˆï¼šä¸šåŠ¡é€»è¾‘å’Œæ•°æ®è®¿é—®æ··åœ¨ä¸€èµ·
2. âŒ ç¼ºå°‘æŠ½è±¡ï¼šç›´æ¥æš´éœ² Dexie API
3. âŒ éš¾ä»¥æµ‹è¯•ï¼šæ— æ³• mock æ•°æ®å±‚
4. âŒ ç¼ºå°‘ç¼“å­˜ï¼šæ¯æ¬¡éƒ½æŸ¥è¯¢æ•°æ®åº“

**å»ºè®®æ¶æ„**:
```typescript
// repositories/chatRepository.ts
export class ChatRepository {
  private cache = new Map()

  async getAll(): Promise<Chat[]> {
    if (this.cache.has('all')) return this.cache.get('all')
    const data = await db.chats.toArray()
    this.cache.set('all', data)
    return data
  }
}

// stores/chat.ts
export const useChatStore = defineStore('chat', () => {
  const repo = new ChatRepository()
  const loadChats = () => repo.getAll()
})
```

**ä¼˜å…ˆçº§**: P1

---

### 7. æ€§èƒ½ä¼˜åŒ–ç©ºé—´

**é—®é¢˜ä¸¥é‡æ€§**: ğŸŸ¡ Important

**æ½œåœ¨æ€§èƒ½é—®é¢˜**:

1. **ä¸å¿…è¦çš„é‡æ¸²æŸ“**:
```typescript
// AIEditing/index.vue - 1,188 è¡Œç»„ä»¶æ¯æ¬¡çŠ¶æ€å˜åŒ–éƒ½å¯èƒ½é‡æ¸²æŸ“
const promptsData = ref({
  system: [19ä¸ªå¯¹è±¡],  // âŒ é™æ€æ•°æ®ä¸åº”è¯¥ç”¨ ref
})
```

2. **æœªä¼˜åŒ–çš„è®¡ç®—å±æ€§**:
```typescript
// services/chat.ts
const sortedChats = computed(() =>
  [...chats.value].sort(...)  // âŒ æ¯æ¬¡è®¿é—®éƒ½é‡æ–°æ’åº
)
```

3. **IndexedDB æŸ¥è¯¢æœªä¼˜åŒ–**:
```typescript
// æ¯æ¬¡éƒ½å…¨é‡æŸ¥è¯¢
await db.messages.where('chatId').equals(chatId).toArray()
// âŒ åº”è¯¥æ·»åŠ åˆ†é¡µã€ç´¢å¼•ä¼˜åŒ–
```

4. **å¤§å‹ä¾èµ–æœªæŒ‰éœ€åŠ è½½**:
```typescript
// ä¸»å…¥å£ç›´æ¥å¯¼å…¥
import * as monaco from 'monaco-editor' // 2.5MB
import Quill from 'quill' // 500KB
// âŒ åº”è¯¥æ‡’åŠ è½½
```

**ä¼˜å…ˆçº§**: P2

---

## ğŸŸ¢ æ¨èä¼˜åŒ– (Recommended)

### 8. ä»£ç ç»„ç»‡ç»“æ„ä¼˜åŒ–

**å½“å‰ç»“æ„**:
```
src/
â”œâ”€â”€ components/          # æ··æ‚ç»„ä»¶
â”‚   â”œâ”€â”€ AIEditing/      # ç‹¬ç«‹ä¸šåŠ¡æ¨¡å—ï¼ˆåº”è¯¥æå‡ï¼‰
â”‚   â”œâ”€â”€ Messages/       # èŠå¤©æ¶ˆæ¯ç»„ä»¶
â”‚   â”œâ”€â”€ Inputs/         # è¡¨å•ç»„ä»¶
â”‚   â””â”€â”€ History/        # å†å²è®°å½•ç»„ä»¶
â”œâ”€â”€ services/           # æ—§æ¶æ„ (19 ä¸ªæ–‡ä»¶åœ¨ç”¨)
â”œâ”€â”€ stores/             # æ–°æ¶æ„ (3 ä¸ªæ–‡ä»¶åœ¨ç”¨)
â””â”€â”€ api/                # API å±‚
```

**å»ºè®®ç»“æ„**:
```
src/
â”œâ”€â”€ features/           # æŒ‰åŠŸèƒ½æ¨¡å—ç»„ç»‡
â”‚   â”œâ”€â”€ chat/
â”‚   â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ stores/
â”‚   â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â””â”€â”€ types/
â”‚   â””â”€â”€ ai-editing/
â”‚       â”œâ”€â”€ components/
â”‚       â”œâ”€â”€ editor/
â”‚       â”œâ”€â”€ stores/
â”‚       â””â”€â”€ types/
â”œâ”€â”€ shared/             # å…±äº«èµ„æº
â”‚   â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ composables/
â”‚   â”œâ”€â”€ utils/
â”‚   â””â”€â”€ types/
â”œâ”€â”€ core/               # æ ¸å¿ƒåŠŸèƒ½
â”‚   â”œâ”€â”€ database/
â”‚   â”œâ”€â”€ api/
â”‚   â””â”€â”€ config/
â””â”€â”€ App.vue
```

**ä¼˜å…ˆçº§**: P2

---

### 9. å›½é™…åŒ–æ”¯æŒä¸å®Œæ•´

**å½“å‰çŠ¶æ€**: å·²å®‰è£… `vue-i18n` ä½†æœªç³»ç»Ÿä½¿ç”¨

```typescript
// âŒ ç¡¬ç¼–ç ä¸­æ–‡
const prompts = {
  name: 'ç¿»è¯‘ä¸ºä¸­æ–‡',
  template: 'å°†ä»¥ä¸‹æ–‡æœ¬ç¿»è¯‘ä¸ºä¸­æ–‡...'
}

// âœ… åº”è¯¥ä½¿ç”¨ i18n
const { t } = useI18n()
const prompts = {
  name: t('prompts.translateToChinese'),
  template: t('prompts.translateTemplate')
}
```

**ä¼˜å…ˆçº§**: P3

---

### 10. ç¼ºå°‘æµ‹è¯•ä½“ç³»

**å½“å‰çŠ¶æ€**: æ— ä»»ä½•æµ‹è¯•æ–‡ä»¶

**å»ºè®®**:
1. å•å…ƒæµ‹è¯• (Vitest)
2. ç»„ä»¶æµ‹è¯• (Vue Test Utils)
3. E2E æµ‹è¯• (Playwright - å·²æœ‰ MCP å·¥å…·)

**ä¼˜å…ˆçº§**: P3

---

## ğŸ“‹ é‡æ„è·¯çº¿å›¾

### ç¬¬ä¸€é˜¶æ®µ: ä¿®å¤ä¸¥é‡é—®é¢˜ (1-2å‘¨)

**ç›®æ ‡**: ä¿®å¤ Critical é—®é¢˜ï¼Œå»ºç«‹ç¨³å®šåŸºç¡€

#### ä»»åŠ¡ 1.1: TypeScript ç±»å‹ç³»ç»Ÿä¿®å¤ (P0)
```typescript
// ä¼˜å…ˆä¿®å¤æ–‡ä»¶ï¼ˆæŒ‰å½±å“èŒƒå›´ï¼‰:
1. src/api/types.ts          - è¡¥å…¨ API ç±»å‹å®šä¹‰
2. src/components/AIEditing/api.ts  - ä¿®å¤ Window ç±»å‹æ‰©å±•
3. src/components/AIEditing/util.ts - æ·»åŠ å‡½æ•°ç­¾å
4. src/components/AIEditing/export.ts - æ¶ˆé™¤ any ç±»å‹
5. src/components/AIEditing/markdown.ts - ä¿®å¤ markdown-it ç±»å‹

// åˆ›å»ºç±»å‹å®šä¹‰æ–‡ä»¶
src/types/
â”œâ”€â”€ global.d.ts       # å…¨å±€ç±»å‹æ‰©å±•
â”œâ”€â”€ quill.d.ts        # Quill ç±»å‹è¡¥å……
â””â”€â”€ window.d.ts       # Window å¯¹è±¡æ‰©å±•
```

**éªŒæ”¶æ ‡å‡†**: `pnpm typecheck` é›¶é”™è¯¯

#### ä»»åŠ¡ 1.2: ç»Ÿä¸€çŠ¶æ€ç®¡ç†æ¶æ„ (P0)
```typescript
// è¿ç§»è®¡åˆ’ï¼šservices â†’ stores

é˜¶æ®µ 1: åˆ›å»º Pinia Store (å·²å®Œæˆ âœ…)
- stores/app.ts      âœ…
- stores/chat.ts     âœ…
- stores/config.ts   âœ…

é˜¶æ®µ 2: è¿ç§»ç»„ä»¶å¼•ç”¨
- 19 ä¸ªä½¿ç”¨ services çš„æ–‡ä»¶ â†’ æ”¹ä¸ºä½¿ç”¨ stores
- åˆ é™¤ services/appConfig.ts å’Œ services/chat.ts

é˜¶æ®µ 3: æ¸…ç†å†—ä½™ä»£ç 
- åˆ é™¤æ—§ services/
- ç»Ÿä¸€å¯¼å‡º stores/index.ts
```

**éªŒæ”¶æ ‡å‡†**: é›¶ `import from 'services'`

#### ä»»åŠ¡ 1.3: æ‹†åˆ† AIEditing å·¨å‹ç»„ä»¶ (P0)
```typescript
// æ‹†åˆ†æ–¹æ¡ˆ
components/AIEditing/
â”œâ”€â”€ index.vue (100 è¡Œ) - ä¸»å®¹å™¨
â”œâ”€â”€ AIEditor.vue       - Quill ç¼–è¾‘å™¨å°è£…
â”œâ”€â”€ DiffViewer.vue     - Monaco Diff æŸ¥çœ‹å™¨
â”œâ”€â”€ PromptPanel.vue    - Prompt é€‰æ‹©é¢æ¿
â”œâ”€â”€ AIChat.vue         - AI å¯¹è¯æµ
â”œâ”€â”€ ExportDialog.vue   - å¯¼å‡ºåŠŸèƒ½
â”œâ”€â”€ ImportDialog.vue   - å¯¼å…¥åŠŸèƒ½
â””â”€â”€ composables/
    â”œâ”€â”€ useQuillEditor.ts
    â”œâ”€â”€ useMonacoDiff.ts
    â”œâ”€â”€ useAIChat.ts
    â””â”€â”€ useEditorStorage.ts
```

**éªŒæ”¶æ ‡å‡†**: å•æ–‡ä»¶ < 300 è¡Œ

---

### ç¬¬äºŒé˜¶æ®µ: å®Œå–„åŸºç¡€è®¾æ–½ (2-3å‘¨)

**ç›®æ ‡**: å»ºç«‹é”™è¯¯å¤„ç†ã€æ—¥å¿—ç³»ç»Ÿ

#### ä»»åŠ¡ 2.1: ç»Ÿä¸€é”™è¯¯å¤„ç†æœºåˆ¶ (P1)
```typescript
// åˆ›å»ºé”™è¯¯å¤„ç†ç³»ç»Ÿ
src/core/errors/
â”œâ”€â”€ ErrorBoundary.vue        # å…¨å±€é”™è¯¯è¾¹ç•Œ
â”œâ”€â”€ errorHandler.ts          # é”™è¯¯å¤„ç†å™¨
â”œâ”€â”€ logger.ts                # æ—¥å¿—ç³»ç»Ÿ
â””â”€â”€ types.ts                 # é”™è¯¯ç±»å‹

// ä½¿ç”¨ç¤ºä¾‹
try {
  await api.chat()
} catch (err) {
  logger.error('Chat API failed', err)
  toast.error(t('errors.chatFailed'))
  // å¯é€‰: ä¸ŠæŠ¥åˆ°é”™è¯¯ç›‘æ§æœåŠ¡
}
```

#### ä»»åŠ¡ 2.2: ä¼˜åŒ–æ•°æ®åº“å±‚ (P1)
```typescript
// åˆ›å»º Repository æ¨¡å¼
src/core/database/
â”œâ”€â”€ repositories/
â”‚   â”œâ”€â”€ ChatRepository.ts
â”‚   â”œâ”€â”€ MessageRepository.ts
â”‚   â””â”€â”€ ConfigRepository.ts
â”œâ”€â”€ cache.ts             # ç¼“å­˜å±‚
â””â”€â”€ migrations.ts        # æ•°æ®åº“è¿ç§»
```

#### ä»»åŠ¡ 2.3: ä¿®å¤æ‰€æœ‰ ESLint é—®é¢˜ (P1)
```bash
pnpm eslint:fix  # è‡ªåŠ¨ä¿®å¤
# æ‰‹åŠ¨ä¿®å¤å‰©ä½™é—®é¢˜
```

---

### ç¬¬ä¸‰é˜¶æ®µ: æ€§èƒ½ä¼˜åŒ– (2å‘¨)

**ç›®æ ‡**: æå‡åº”ç”¨æ€§èƒ½å’Œç”¨æˆ·ä½“éªŒ

#### ä»»åŠ¡ 3.1: æ‡’åŠ è½½å’Œä»£ç åˆ†å‰²
```typescript
// vite.config.ts
export default defineConfig({
  build: {
    rollupOptions: {
      output: {
        manualChunks: {
          monaco: ['monaco-editor'],
          quill: ['quill', 'quill-table-ui'],
          markdown: ['markdown-it', 'katex'],
        }
      }
    }
  }
})

// è·¯ç”±æ‡’åŠ è½½
const AIEditing = () => import('./features/ai-editing/index.vue')
```

#### ä»»åŠ¡ 3.2: ç»„ä»¶æ¸²æŸ“ä¼˜åŒ–
```typescript
// ä½¿ç”¨ computed + memoization
const sortedChats = computed(() => {
  const key = chats.value.map(c => c.id).join(',')
  return memoize(key, () => [...chats.value].sort(...))
})

// ä½¿ç”¨è™šæ‹Ÿæ»šåŠ¨
<VirtualScroller :items="messages" />
```

#### ä»»åŠ¡ 3.3: IndexedDB æŸ¥è¯¢ä¼˜åŒ–
```typescript
// æ·»åŠ ç´¢å¼•
db.version(2).stores({
  messages: '++id, chatId, createdAt, [chatId+createdAt]'
})

// åˆ†é¡µæŸ¥è¯¢
async getMessages(chatId: number, page = 0, size = 50) {
  return db.messages
    .where('[chatId+createdAt]')
    .between([chatId, Dexie.minKey], [chatId, Dexie.maxKey])
    .offset(page * size)
    .limit(size)
    .toArray()
}
```

---

### ç¬¬å››é˜¶æ®µ: åŠŸèƒ½å®Œå–„ (2-3å‘¨)

**ç›®æ ‡**: å®Œå–„å¼€å‘ä½“éªŒå’Œä»£ç è´¨é‡

#### ä»»åŠ¡ 4.1: é‡ç»„é¡¹ç›®ç»“æ„ (P2)
```bash
# æŒ‰åŠŸèƒ½æ¨¡å—é‡ç»„
git mv src/components/AIEditing src/features/ai-editing
git mv src/components/Messages src/features/chat/components
```

#### ä»»åŠ¡ 4.2: å®Œå–„å›½é™…åŒ– (P3)
```typescript
// locales/zh-CN.json
{
  "prompts": {
    "translateToChinese": "ç¿»è¯‘ä¸ºä¸­æ–‡",
    "translateTemplate": "å°†ä»¥ä¸‹æ–‡æœ¬ç¿»è¯‘ä¸ºä¸­æ–‡..."
  }
}
```

#### ä»»åŠ¡ 4.3: å»ºç«‹æµ‹è¯•ä½“ç³» (P3)
```typescript
// tests/unit/stores/chat.spec.ts
describe('useChatStore', () => {
  it('should load chats', async () => {
    const store = useChatStore()
    await store.loadChats()
    expect(store.chats.length).toBeGreaterThan(0)
  })
})
```

---

## ğŸ¯ é¢„æœŸæ”¶ç›Š

### ä»£ç è´¨é‡æå‡
- âœ… TypeScript ç±»å‹è¦†ç›–ç‡: 0% â†’ 95%
- âœ… ESLint é€šè¿‡ç‡: 0% â†’ 100%
- âœ… æœ€å¤§æ–‡ä»¶å¤§å°: 1188 è¡Œ â†’ < 300 è¡Œ
- âœ… å•å…ƒæµ‹è¯•è¦†ç›–ç‡: 0% â†’ 60%

### å¼€å‘æ•ˆç‡æå‡
- âœ… ä»£ç æ™ºèƒ½æç¤ºå®Œæ•´
- âœ… é‡æ„é£é™©é™ä½ 80%
- âœ… Bug å®šä½æ—¶é—´å‡å°‘ 60%
- âœ… æ–°åŠŸèƒ½å¼€å‘é€Ÿåº¦æå‡ 40%

### æ€§èƒ½æå‡
- âœ… é¦–å±åŠ è½½æ—¶é—´å‡å°‘ 30%
- âœ… ç»„ä»¶æ¸²æŸ“æ€§èƒ½æå‡ 50%
- âœ… æ•°æ®åº“æŸ¥è¯¢é€Ÿåº¦æå‡ 40%

### å¯ç»´æŠ¤æ€§æå‡
- âœ… æ¶æ„æ¸…æ™°ï¼ŒèŒè´£æ˜ç¡®
- âœ… ä»£ç å¤ç”¨æ€§æå‡ 50%
- âœ… æ–°äººä¸Šæ‰‹æ—¶é—´å‡å°‘ 50%

---

## ğŸ› ï¸ å®æ–½å»ºè®®

### èµ„æºæŠ•å…¥
- **å…¨èŒå¼€å‘**: 1-2 äºº
- **æ€»æ—¶é—´**: 6-8 å‘¨
- **åˆ†é˜¶æ®µäº¤ä»˜**: æ¯ 2 å‘¨ä¸€ä¸ªé‡Œç¨‹ç¢‘

### é£é™©ç®¡ç†
1. **å‘åå…¼å®¹**: ä¿æŒç°æœ‰åŠŸèƒ½å¯ç”¨
2. **ç°åº¦å‘å¸ƒ**: åˆ†æ¨¡å—é€æ­¥ä¸Šçº¿
3. **å›æ»šæ–¹æ¡ˆ**: æ¯é˜¶æ®µä¿ç•™å›æ»šç‚¹
4. **æµ‹è¯•è¦†ç›–**: é‡æ„å‰æ·»åŠ é›†æˆæµ‹è¯•

### æˆåŠŸæ ‡å‡†
- âœ… é›¶ TypeScript é”™è¯¯
- âœ… é›¶ ESLint é”™è¯¯
- âœ… æµ‹è¯•è¦†ç›–ç‡ > 60%
- âœ… æ‰€æœ‰ç°æœ‰åŠŸèƒ½æ­£å¸¸å·¥ä½œ
- âœ… æ€§èƒ½æŒ‡æ ‡æå‡ 30%+

---

## ğŸ“š å‚è€ƒèµ„æº

### è®¾è®¡æ¨¡å¼
- Repository Pattern (æ•°æ®è®¿é—®å±‚)
- Composition API Pattern (Vue 3)
- Error Boundary Pattern (é”™è¯¯å¤„ç†)

### æœ€ä½³å®è·µ
- [Vue 3 å®˜æ–¹é£æ ¼æŒ‡å—](https://vuejs.org/style-guide/)
- [TypeScript Deep Dive](https://basarat.gitbook.io/typescript/)
- [Pinia Best Practices](https://pinia.vuejs.org/cookbook/)

### å·¥å…·æ¨è
- Vitest (å•å…ƒæµ‹è¯•)
- Vue Test Utils (ç»„ä»¶æµ‹è¯•)
- Playwright (E2E æµ‹è¯•)
- Vite Plugin Checker (æ„å»ºæ—¶ç±»å‹æ£€æŸ¥)

---

**æŠ¥å‘Šç”Ÿæˆæ—¶é—´**: 2025-10-01
**åˆ†æå·¥å…·**: Claude Code Architecture Analyzer
**é¡¹ç›®ç‰ˆæœ¬**: 0.0.0
