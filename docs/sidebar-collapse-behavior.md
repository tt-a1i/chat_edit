# 侧边栏展开时文字塌缩问题记录

## 问题现象

- 折叠状态下侧边栏只显示图标，表现正常。
- 从折叠切换到展开时，`Toggle dark mode`、`System prompt`、以及删除相关按钮的文字先被压缩成竖排，随后才恢复到水平排版，视觉上像是“文字塌缩”。

## 原因分析

- 旧实现通过 `w-0 / w-auto` 等 class 在同一时刻同时调整容器宽度和文字可见性。
- 展开动画尚未完成时，按钮的实际宽度仍然很小，浏览器在布局阶段不得不将文字强行压缩，导致先出现竖排再扩散开的现象。
- 底部按钮与顶部菜单共用这一逻辑，因此问题集中出现在 `Toggle dark mode`、`System prompt` 等区域。

## 解决方案

1. 为侧边栏主体添加 `ref`，折叠 → 展开时使用 `requestAnimationFrame` 轮询 `offsetWidth`，只有当宽度恢复到正常值（当前阈值 200px）后才显示文字。
2. 统一使用 `showSidebarText` 控制所有按钮文案的渲染，折叠状态下直接移除文字节点，避免“半透明但仍占位”的状态。
3. 调整折叠态的 `gap`/`px`，保证图标在折叠模式下居中，展开时自动恢复横向布局。

## 参考提交

- `src/components/common/Sidebar.vue` 的更新（当前分支最新版本）。
